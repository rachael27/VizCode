<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrate the topological structure of both hierarchies</title>
</head>

<body>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script>

        d3.queue()
            .defer(d3.csv, "File/primaryH.csv")
            .defer(d3.csv, "File/secondaryH.csv")
            .await(function (error, h1, h2) {
                if (error) throw error;




                var margin = { top: 30, right: 30, bottom: 30, left: 120 },
                    width = 4000 - margin.left - margin.right,
                    height = 1000 - margin.top - margin.bottom;

                var svg = d3
                    .select("#content")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform",
                        "translate(" + (margin.left + 230) + "," + (margin.top + 100) + ")");

                var tooltip = d3.select("#content")
                    .append("div")
                    .style("opacity", 0)
                    .attr("class", "tooltip")
                    //.style("background-color", "white")
                    .style("border", "solid")
                    //.style("font", "40px times")
                    .style("border-width", "2px")
                    .style("border-radius", "5px")
                    .style("padding", "5px");


                const depthArray = [];

                // console.log(h1);

                stratify = d3
                    .stratify()
                    .id(function (d) {
                        return d.child;
                    })
                    .parentId(function (d) {
                        return d.parent;
                    });

                var h1_struct = stratify(h1);
                var h2_struct = stratify(h2);

                var h1_rootElement = d3.hierarchy(h1_struct);
                var h2_rootElement = d3.hierarchy(h2_struct);

                console.log(h1_rootElement);
                console.log(h2_rootElement);


                var h1_dims = findDimensions(h1_rootElement);
                var h2_dims = findDimensions(h2_rootElement);



                console.log(h1_dims);
                console.log(h2_dims);


                //  var h1_levels = h1_rootElement.data.height;
                //  var h2_levels = h2_rootElement.data.height;



                compareDimensions(h1_dims, h2_dims);







                function findDimensions(root) {
                    const arrDims = [];

                    for (let i = 0; i <= root.height; i++) {
                        arrDims.push([]);
                    }

                    // console.log(arrDims);

                    root.eachBefore(function (d) {
                        const str = d.depth;
                        //  arrDims[str].push({ "name": d.data.data.child, "depth": d.depth, "height": d.height });
                        arrDims[str].push(d.data.data.child);

                    });

                    return arrDims;
                }


                function compareDimensions(h1, h2) {
                    const arrDims = [];

                    // console.log(h1);
                    var maxLevels = h1.length;
                    if (maxLevels < h2.length)
                        maxLevels = h2.length;

                    // console.log(maxLevels);

                    for (let i = 0; i < maxLevels; i++) {
                        arrDims.push([]);
                    }

                    //  console.log(arrDims);
                    arrDims[0].push({ "name": "root", "color": "purple" });
                    var flag = 0;




                    // arrDims[i].push(h1[i][ii]);


                    for (let j = 1; j < h2.length; j++) {
                        for (let jj = 0; jj < h2[j].length; jj++) {
                            arrDims[j].push({ "name": h2[j][jj], "color": "red" });
                        }
                    }


                    for (let i = 1; i < h1.length; i++) {
                        for (let ii = 0; ii < h1[i].length; ii++) {
                            arrDims[j].push({ "name": h2[j][jj], "color": "red" });
                        }
                    }


                    /* for (let j = 1; j < h2.length; j++) {
                        flag = "";
                        for (let jj = 0; jj < h2[j].length; jj++) {
                            flag = "red";
                            for (let i = 1; i < h1.length; i++) {
                                for (let ii = 0; ii < h1[i].length; ii++) {
                                    flag = "blue";
                                    if (h2[j][jj] == h1[i][ii]) {
                                        arrDims[j].push({ "name": h2[j][jj], "color": "purple" });
                                        flag = "purple";
                                    }


                                }
                            }


                        }
                    } */

                    console.log(arrDims);
                }

            });

    </script>
</body>

</html>