<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrate the topological structure of both hierarchies</title>
    <link rel="icon" href="Images/hierarchy3.png">

    <style>
        .dot {
            height: 25px;
            width: 25px;
            border-radius: 50%;
            display: inline-block;
        }

        .dot scrolls {
            overflow-x: scroll;
            overflow-y: hidden;
            height: 80px;
            white-space: nowrap
        }


        /************/

        body {
            padding: 50px;
            font-family: Arial;
            font-size: 10px;
        }

        .axis path,
        .axis line {

            stroke: #000;
            stroke-width: 0px;
            opacity: 0;
            shape-rendering: geometricPrecision;
            /*shape-rendering: crispEdges;*/
        }

        /*  .x.axis path {
            display: none;
        } */

        .tick text {
            font-size: 30px;
            opacity: 0;
        }

        .line {

            opacity: 0.5;

        }
    </style>
</head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/ae1e2e7d99.js" crossorigin="anonymous"></script>



<body>

    <ul class="nav nav-tabs" id="myTab" role="tablist" style="font-size: 50px;">

        <li class="nav-item" role="presentation">
            <button class="nav-link" id="treeswolinking-tab" data-bs-toggle="tab" data-bs-target="#treeswolinking"
                type="button" role="tab" aria-controls="profile" aria-selected="true">Manual
                comparison - 2
                trees</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="treeswlinking-tab" data-bs-toggle="tab" data-bs-target="#treeswlinking"
                type="button" role="tab" aria-controls="contact" aria-selected="false">Partial
                auto/manual - 2 trees
                with
                linking</button>
        </li>

        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="mergedtrees-tab" data-bs-toggle="tab" data-bs-target="#mergedtree-div"
                type="button" role="tab" aria-controls="contact" aria-selected="false">Merged
                Tree</button>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane" id="treeswolinking" role="tabpanel" aria-labelledby="treeswolinking-tab">
            <h1> Trees without linking - Manual inspection</h1>
        </div>
        <div class="tab-pane" id="treeswlinking" role="tabpanel" aria-labelledby="treeswlinking-tab">
            <h1> Trees with linking - Partial auto/manual inspection</h1>
        </div>
        <div class="tab-pane active" id="mergedtree-div" role="tabpanel" aria-labelledby="mergedtrees-tab">
            <h1> MergedTree</h1>
        </div>
    </div>


    <div class="container-fluid">
        <div class="row scrolls">
            <div class="col-2" style="font-size: 30px; margin-left: 20px;">

                <fieldset class="border p-2" style="margin-top:150px;">
                    <legend class="w-auto">Dataset</legend>

                    <br>
                    <button type="button" id="swapdataset" class="btn btn-primary" style="margin-top:50px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor"
                            class="bi bi-arrow-left-right" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z">
                            </path>
                        </svg>
                        <h2>Swap primary and secondary datasets</h2>
                    </button>


                    <div class="form-check" style="margin-top:20px;">
                        <input class="form-check-input" type="radio" name="fileversionradio" id="fileversion0radio"
                            checked>
                        <label class="form-check-label" for="fileversion0radio">
                            File Version 0 (Default)
                        </label>
                    </div>

                    <div class="form-check" style="margin-top:10px;">
                        <input class="form-check-input" type="radio" name="fileversionradio" id="fileversion1radio">
                        <label class="form-check-label" for="fileversion1radio">
                            File Version 1
                        </label>
                    </div>

                    <div class="form-check" style="margin-top:10px;">
                        <input class="form-check-input" type="radio" name="fileversionradio" id="fileversion5radio">
                        <label class="form-check-label" for="fileversion5radio">
                            Project Team
                        </label>
                    </div>

                    <div class="form-check" style="margin-top:10px;">
                        <input class="form-check-input" type="radio" name="fileversionradio" id="fileversion2radio">
                        <label class="form-check-label" for="fileversion2radio">
                            File Version 2 - Log Files
                        </label>
                    </div>

                    <div class="form-check" style="margin-top:10px;">
                        <input class="form-check-input" type="radio" name="fileversionradio" id="fileversion6radio">
                        <label class="form-check-label" for="fileversion6radio">
                            Book Classification
                        </label>
                    </div>

                    <div class="form-check" style="margin-top:10px;">
                        <input class="form-check-input" type="radio" name="fileversionradio" id="fileversion3radio">
                        <label class="form-check-label" for="fileversion3radio">
                            UK SIC - v4 and v3.1
                        </label>
                    </div>

                    <div class="form-check" style="margin-top:10px;">
                        <input class="form-check-input" type="checkbox" id="filterdatacheck" name="filterdata"
                            value="yes">
                        <label class="form-check-label" for="filterdata"> Filter Data by Categories - A, B and C
                        </label><br>
                    </div>

                </fieldset>


                <fieldset class="border p-2" style="margin-top:100px;">
                    <legend class="w-auto">Styling level lines</legend>
                    <div class="form-check" style="margin-top:50px;">
                        <input class="form-check-input" type="radio" name="levelcolorradio" id="fillcolorradio">
                        <label class="form-check-label" for="fillcolorradio">
                            Fill level lines with color
                            <span class="dot"
                                style="background: radial-gradient(circle, rgba(238,174,202,1) 0%, rgba(148,187,233,1) 100%);">
                        </label> </span>

                        <br>
                        <input class="form-check-input" type="radio" name="levelcolorradio" id="fillnoneradio" checked>
                        <label class="form-check-label" for="fillnoneradio">
                            No color
                            <span class="dot" style="background-color: none;"> </label> </span>


                    </div>
                </fieldset>



                <fieldset class="border p-2" style="margin-top:100px;">
                    <legend class="w-auto">Change color theme</legend>
                    <div class="form-check" style="margin-top:50px;">
                        <input class="form-check-input" type="radio" name="nodecolorradio" id="blueredradio" checked>
                        <label class="form-check-label" for="blueredradio">
                            blue/Red Theme (default)
                            <br>
                            <span class="dot" style="background-color: blue;"></span> +
                            <span class="dot" style="background-color: red;"></span> =
                            <span class="dot" style="background-color: purple;"></span>
                        </label>
                    </div>
                    <div class="form-check" style="margin-top:20px;">
                        <input class="form-check-input" type="radio" name="nodecolorradio" id="orangeblueradio">
                        <label class="form-check-label" for="orangeblueradio">
                            Orange/blue Theme
                            <br>
                            <span class="dot" style="background-color: orange;"></span> +
                            <span class="dot" style="background-color: blue;"></span> =
                            <span class="dot" style="background-color: yellowgreen;"></span>
                        </label>
                    </div>
                    <!--
                        <div class="form-check" style=" margin-top:20px;">
                        <input class="form-check-input" type="radio" name="nodecolorradio" id="redgreenradio">
                        <label class="form-check-label" for="redgreenradio">
                            Red/Green Theme
                            <br>
                            <span class="dot" style="background-color: red;"></span> +
                            <span class="dot" style="background-color: green;"></span> =
                            <span class="dot" style="background-color: brown;"></span>
                        </label>
                    </div>
                -->
                </fieldset>


                <fieldset class="border p-2" style="margin-top:100px;">
                    <legend class="w-auto">Change node shape</legend>
                    <div class="form-check" style="margin-top:50px; ">
                        <input class="form-check-input" type="radio" name="nodeshaperadio" id="solidshaperadio">
                        <label class="form-check-label" for="solidshaperadio">
                            Solid Circles in different colors
                            <br>
                            <span class="dot" style="background-color: blue;"></span> +
                            <span class="dot" style="background-color: red;"></span> =
                            <span class="dot" style="background-color: purple;"></span>

                        </label>
                    </div>
                    <div class="form-check" style=" margin-top:20px;">
                        <input class="form-check-input" type="radio" name="nodeshaperadio" id="hollowshaperadio"
                            checked>
                        <label class="form-check-label" for="hollowshaperadio">
                            A combination of hollow and solid circles
                            <br>


                            <span style="background-color: white;  border-color:blue; border-style:solid; border-width: 5px; height: 25px;
                        width: 25px; border-radius: 50%; display: inline-block;"></span> +
                            <span class="dot" style="background-color: blue;"></span> =
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="blue"
                                class="bi bi-record-circle" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                <path d="M11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                            </svg>


                        </label>
                        <g id="solidhollowcircle"></g>
                    </div>
                </fieldset>

                <!--
                <fieldset class="border p-2" style="margin-top:100px;">
                    <legend class="w-auto">Change leaf height</legend>
                    <div class="form-check" style="margin-top:50px; ">
                        <input class="form-check-input" type="radio" name="leavesheightradio"
                            id="leavessameheightradio">
                        <label class="form-check-label" for="leavessameheightradio">
                            Set leaves on the same level
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="leavesheightradio" id="leavesdiffheightradio"
                            checked>
                        <label class="form-check-label" for="leavesheightradio">
                            Set leaves based on their height in the tree
                        </label>
                    </div>
                </fieldset>


                <fieldset class="border p-2" style="margin-top:100px;">
                    <legend class="w-auto">Show/hide edges & nodes while re-routing</legend>
                    <div class="form-check" style="margin-top:50px; ">
                        <input class="form-check-input" type="radio" name="showhidenodes" id="shownodesradio">
                        <label class="form-check-label" for="shownodesradio">
                            Show all nodes during edge re-routing
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="showhidenodes" id="hidenodesradio" checked>
                        <label class="form-check-label" for="hidenodesradio">
                            Hide only nodes during edge re-routing
                        </label>
                    </div>
                    

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="showhidenodes" id="hidenodesedgesradio"
                            checked>
                        <label class="form-check-label" for="hidenodesedgesradio">
                            Hide nodes and edges during edge re-routing
                        </label>
                    </div>
                </fieldset>

                -->


                <fieldset class="border p-2" style="margin-top:100px;">
                    <legend class="w-auto">Layout</legend>

                    <div class="form-check" style="margin-top:50px; ">
                        <input class="form-check-input" type="radio" name="layoutradio" id="sideradio">
                        <label class="form-check-label" for="sideradio">
                            Trees are laid side-by-side
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="layoutradio" id="def_tbradio">
                        <label class="form-check-label" for="def_tbradio">
                            Default Top-bottom layout
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="layoutradio" id="tbradio">
                        <label class="form-check-label" for="tbradio">
                            Top-bottom layout
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="layoutradio" id="lrradio">
                        <label class="form-check-label" for="lrradio">
                            Left-right layout
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="layoutradio" id="lrleavesradio" checked>
                        <label class="form-check-label" for="lrleavesradio">
                            Left-right leaves facing-first layout
                        </label>
                    </div>


                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="layoutradio" id="tlbrradio">
                        <label class="form-check-label" for="tlbrradio">
                            Top-left and bottom right layout
                        </label>
                    </div>


                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="layoutradio" id="ang_tlbrradio">
                        <label class="form-check-label" for="ang_tlbrradio">
                            Angled top-left and bottom-right layout
                        </label>
                    </div>


                </fieldset>


                <fieldset class="border p-2" style="margin-top:100px;">
                    <legend class="w-auto">Type of links</legend>
                    <div class="form-check" style="margin-top:50px; ">
                        <input class="form-check-input" type="radio" name="linesradio" id="straightlradio" checked>
                        <label class="form-check-label" for="straightlradio">
                            Straight lines
                        </label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="linesradio" id="curvedlradio">
                        <label class="form-check-label" for="curvedlradio">
                            Curved links
                        </label>
                    </div>

                </fieldset>

            </div>


            <div id="content" class="col-9">

            </div>
        </div>



    </div>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script>






        var fileversion = "File0";
        var swapdataset = "h1";

        var h1 = "";
        var h2 = "";


        var mtree = "";



        var title = [];

        if (d3.select("#fileversion0radio")._groups[0][0].checked == true || d3.select("#fileversion1radio")._groups[0][0].checked == true || d3.select("#fileversion5radio")._groups[0][0].checked == true)
            title = ["Base Hierarchy", "Target Hierarchy", "Merged Hierarchy - Target mapped onto Base "];

        else if (d3.select("#fileversion2radio")._groups[0][0].checked == true)
            title = ["Base Hierarchy - Log Week 1", "Target Hierarchy - Log Week 2", "Merged Hierarchy - Target mapped onto Base "];

        else if (d3.select("#fileversion6radio")._groups[0][0].checked == true)
            title = ["Base Hierarchy - UOS Library", "Target Hierarchy QNL", "Merged Hierarchy - Target mapped onto Base "];

        else if (d3.select("#fileversion5radio")._groups[0][0].checked == true)
            title = ["Base Hierarchy - NPRP Project Team", "Target Hierarchy - PhD Team ", "Merged Hierarchy - Target mapped onto Base "];



        else if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
            title = ["Base Hierarchy - International Standard Industrial Classification of All Economic Activities (ISIC) v3.1", "Target Hierarchy - ISIC v4.0", "Merged Hierarchy - Target mapped onto Base "];



        d3.select("#swapdataset").on("click", function () {
            console.log("Swapdataset");
            if (d3.select("#fileversion0radio")._groups[0][0].checked == true)
                fileversion = "File0";
            else if (d3.select("#fileversion1radio")._groups[0][0].checked == true)
                fileversion = "File1";
            else if (d3.select("#fileversion2radio")._groups[0][0].checked == true)
                fileversion = "File2";
            else if (d3.select("#fileversion6radio")._groups[0][0].checked == true)
                fileversion = "File6";
            else if (d3.select("#fileversion5radio")._groups[0][0].checked == true)
                fileversion = "File5";
            else if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                fileversion = "File3";


            if (swapdataset == "h1") {
                d3.queue()
                    .defer(d3.csv, "File/" + fileversion + "-primaryH.csv")
                    .defer(d3.csv, "File/" + fileversion + "-secondaryH.csv")
                    .await(function (error, h1, h2) {
                        if (error) throw error;

                        else
                            runScript_tabs(h2, h1);
                    });
                swapdataset = "h2";
            }
            else {
                d3.queue()
                    .defer(d3.csv, "File/" + fileversion + "-primaryH.csv")
                    .defer(d3.csv, "File/" + fileversion + "-secondaryH.csv")
                    .await(function (error, h1, h2) {
                        if (error) throw error;

                        else
                            runScript_tabs(h1, h2);
                    });
                swapdataset = "h1";
            }

        });

        d3.select("#fileversion0radio").on("change", function () {

            if (d3.select("#fileversion0radio")._groups[0][0].checked == true || d3.select("#fileversion1radio")._groups[0][0].checked == true || d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy", "Target Hierarchy", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion2radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - Log Week 1", "Target Hierarchy - Log Week 2", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion6radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - UOS Library", "Target Hierarchy QNL", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - NPRP Project Team", "Target Hierarchy - PhD Team ", "Merged Hierarchy - Target mapped onto Base "];



            else if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - International Standard Industrial Classification of All Economic Activities (ISIC) v3.1", "Target Hierarchy - ISIC v4.0", "Merged Hierarchy - Target mapped onto Base "];


            d3.selectAll("#filterdatacheck").property('checked', false);
            if (d3.select("#fileversion0radio")._groups[0][0].checked == true)
                fileversion = "File0";

            d3.queue()
                .defer(d3.csv, "File/" + fileversion + "-primaryH.csv")
                .defer(d3.csv, "File/" + fileversion + "-secondaryH.csv")
                .await(function (error, h1, h2) {
                    if (error) throw error;

                    else {
                        window.h1 = h1;
                        window.h2 = h2;
                        //h1 = h1;
                        //h2 = h2;
                        //console.log(h1);
                        runScript_tabs(h1, h2);
                    }

                });

        });

        d3.select("#fileversion1radio").on("change", function () {

            if (d3.select("#fileversion0radio")._groups[0][0].checked == true || d3.select("#fileversion1radio")._groups[0][0].checked == true || d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy", "Target Hierarchy", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion2radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - Log Week 1", "Target Hierarchy - Log Week 2", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion6radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - UOS Library", "Target Hierarchy QNL", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - NPRP Project Team", "Target Hierarchy - PhD Team ", "Merged Hierarchy - Target mapped onto Base "];



            else if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - International Standard Industrial Classification of All Economic Activities (ISIC) v3.1", "Target Hierarchy - ISIC v4.0", "Merged Hierarchy - Target mapped onto Base "];



            d3.selectAll("#filterdatacheck").property('checked', false);
            if (d3.select("#fileversion1radio")._groups[0][0].checked == true)
                fileversion = "File1";

            d3.queue()
                .defer(d3.csv, "File/" + fileversion + "-primaryH.csv")
                .defer(d3.csv, "File/" + fileversion + "-secondaryH.csv")
                .await(function (error, h1, h2) {
                    if (error) throw error;

                    else {
                        window.h1 = h1;
                        window.h2 = h2;
                        runScript_tabs(h1, h2);
                    }
                });
        });


        d3.select("#fileversion2radio").on("change", function () {

            if (d3.select("#fileversion0radio")._groups[0][0].checked == true || d3.select("#fileversion1radio")._groups[0][0].checked == true || d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy", "Target Hierarchy", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion2radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - Log Week 1", "Target Hierarchy - Log Week 2", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion6radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - UOS Library", "Target Hierarchy QNL", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - NPRP Project Team", "Target Hierarchy - PhD Team ", "Merged Hierarchy - Target mapped onto Base "];



            else if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - International Standard Industrial Classification of All Economic Activities (ISIC) v3.1", "Target Hierarchy - ISIC v4.0", "Merged Hierarchy - Target mapped onto Base "];



            d3.selectAll("#filterdatacheck").property('checked', false);
            if (d3.select("#fileversion2radio")._groups[0][0].checked == true)
                fileversion = "File4";
            //fileversion = "File5";


            d3.queue()
                .defer(d3.csv, "File/" + fileversion + "-primaryHA-reduced.csv")
                .defer(d3.csv, "File/" + fileversion + "-secondaryHB-reduced.csv")
                //.defer(d3.csv, "File/" + fileversion + "-primaryH.csv")
                //.defer(d3.csv, "File/" + fileversion + "-secondaryH.csv")
                .await(function (error, h1, h2) {
                    if (error) throw error;

                    else {
                        window.h1 = h1;
                        window.h2 = h2;
                        runScript_tabs(h1, h2);
                    }
                });
        });

        d3.select("#fileversion3radio").on("change", function () {

            if (d3.select("#fileversion0radio")._groups[0][0].checked == true || d3.select("#fileversion1radio")._groups[0][0].checked == true || d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy", "Target Hierarchy", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion2radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - Log Week 1", "Target Hierarchy - Log Week 2", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion6radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - UOS Library", "Target Hierarchy QNL", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - NPRP Project Team", "Target Hierarchy - PhD Team ", "Merged Hierarchy - Target mapped onto Base "];



            else if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - International Standard Industrial Classification of All Economic Activities (ISIC) v3.1", "Target Hierarchy - ISIC v4.0", "Merged Hierarchy - Target mapped onto Base "];



            if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                fileversion = "File3";

            d3.selectAll("#filterdatacheck").property('checked', true);

            d3.queue()
                .defer(d3.csv, "File/" + fileversion + "-primaryH.csv")
                .defer(d3.csv, "File/" + fileversion + "-secondaryH.csv")
                .await(function (error, h1, h2) {
                    if (error) throw error;

                    else {
                        window.h1 = h1;
                        window.h2 = h2;
                        //h1 = h1;
                        //h2 = h2;
                        runScript_tabs(h1, h2);
                    }
                });
        });

        d3.select("#fileversion5radio").on("change", function () {

            if (d3.select("#fileversion0radio")._groups[0][0].checked == true || d3.select("#fileversion1radio")._groups[0][0].checked == true || d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy", "Target Hierarchy", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion2radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - Log Week 1", "Target Hierarchy - Log Week 2", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion6radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - UOS Library", "Target Hierarchy QNL", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - NPRP Project Team", "Target Hierarchy - PhD Team ", "Merged Hierarchy - Target mapped onto Base "];



            else if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - International Standard Industrial Classification of All Economic Activities (ISIC) v3.1", "Target Hierarchy - ISIC v4.0", "Merged Hierarchy - Target mapped onto Base "];

            if (d3.select("#fileversion5radio")._groups[0][0].checked == true)
                fileversion = "File5";

            d3.selectAll("#filterdatacheck").property('checked', false);

            d3.queue()
                .defer(d3.csv, "File/" + fileversion + "-primaryH.csv")
                .defer(d3.csv, "File/" + fileversion + "-secondaryH.csv")
                .await(function (error, h1, h2) {
                    if (error) throw error;

                    else {
                        window.h1 = h1;
                        window.h2 = h2;
                        //h1 = h1;
                        //h2 = h2;
                        runScript_tabs(h1, h2);
                    }
                });
        });

        d3.select("#fileversion6radio").on("change", function () {

            if (d3.select("#fileversion0radio")._groups[0][0].checked == true || d3.select("#fileversion1radio")._groups[0][0].checked == true || d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy", "Target Hierarchy", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion2radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - Log Week 1", "Target Hierarchy - Log Week 2", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion6radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - UOS Library", "Target Hierarchy QNL", "Merged Hierarchy - Target mapped onto Base "];

            else if (d3.select("#fileversion5radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - NPRP Project Team", "Target Hierarchy - PhD Team ", "Merged Hierarchy - Target mapped onto Base "];



            else if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                title = ["Base Hierarchy - International Standard Industrial Classification of All Economic Activities (ISIC) v3.1", "Target Hierarchy - ISIC v4.0", "Merged Hierarchy - Target mapped onto Base "];




            if (d3.select("#fileversion6radio")._groups[0][0].checked == true)
                fileversion = "File6";

            d3.selectAll("#filterdatacheck").property('checked', false);



            d3.queue()
                //.defer(d3.csv, "File/" + fileversion + "-secondaryHJ.csv")
                //.defer(d3.csv, "File/" + fileversion + "-primaryH-edited-J.csv")
                .defer(d3.csv, "File/" + fileversion + "-secondaryH.csv")
                .defer(d3.csv, "File/" + fileversion + "-primaryH.csv")
                .await(function (error, h1, h2) {
                    if (error) throw error;

                    else {
                        window.h1 = h1;
                        window.h2 = h2;
                        //h1 = h1;
                        //h2 = h2;
                        runScript_tabs(h1, h2);
                    }
                });
        });


        d3.queue()
            .defer(d3.csv, "File/" + fileversion + "-primaryH.csv")
            .defer(d3.csv, "File/" + fileversion + "-secondaryH.csv")
            .await(function (error, h1, h2) {
                if (error) throw error;

                else {
                    window.h1 = h1;
                    window.h2 = h2;
                    //h1 = h1;
                    //h2 = h2;
                    runScript_tabs(h1, h2);
                }
            });


        function runScript_tabs(h1, h2) {

            //console.log(h1);
            //console.log(h2);

            //console.log((document.getElementById("treeswolinking-tab").getAttribute("class").includes("active")));
            //console.log((document.getElementById("treeswlinking-tab").getAttribute("class").includes("active")));
            //console.log((document.getElementById("mergedtrees-tab").getAttribute("class").includes("active")));

            if (document.getElementById("treeswolinking-tab").getAttribute("class").includes("active")) {
                d3.select("#treeswlinking-tab")
                    .classed("active", false);

                d3.select("#treeswolinking-tab")
                    .classed("active", true);

                d3.select("#mergedtrees-tab")
                    .classed("active", false);

                d3.select("#content")
                    .select("#mergedtree_svg")
                    .remove();

                d3.select("#content")
                    .select("#treeswlinking_svg")
                    .remove();

                d3.select("#content")
                    .select("#treeswolinking_svg")
                    .remove();


                //console.log("treeswolinking tab");

                runScript_treeswolinking(h1, h2);
            }
            else if (document.getElementById("treeswlinking-tab").getAttribute("class").includes("active")) {
                d3.select("#treeswlinking-tab")
                    .classed("active", true);

                d3.select("#treeswolinking-tab")
                    .classed("active", false);

                d3.select("#mergedtrees-tab")
                    .classed("active", false);

                d3.select("#content")
                    .select("#mergedtree_svg")
                    .remove();


                d3.select("#content")
                    .select("#treeswolinking_svg")
                    .remove();

                d3.select("#content")
                    .select("#treeswlinking_svg")
                    .remove();

                //console.log("treeswlinking tab");

                runScript_treeswlinking(window.h1, window.h2);

            }
            else {
                d3.select("#treeswlinking-tab")
                    .classed("active", false);

                d3.select("#treeswolinking-tab")
                    .classed("active", false);

                d3.select("#mergedtrees-tab")
                    .classed("active", true);


                d3.select("#content")
                    .select("#treeswlinking_svg")
                    .remove();

                d3.select("#content")
                    .select("#treeswolinking_svg")
                    .remove();

                d3.select("#content")
                    .select("#mergedtree_svg")
                    .remove();

                //console.log(window.h1);
                //console.log(window);
                //console.log("mergedtree tab");

                runScript_mergedtree(h1, h2);

            }

        }


        d3.select("#mergedtrees-tab")
            .on("click", function () {

                //console.log(window.h1);
                //console.log(swapdataset);

                d3.select("#treeswlinking-tab")
                    .classed("active", false);

                d3.select("#treeswolinking-tab")
                    .classed("active", false);

                d3.select("#mergedtrees-tab")
                    .classed("active", true);


                d3.select("#content")
                    .select("#treeswlinking_svg")
                    .remove();

                d3.select("#content")
                    .select("#treeswolinking_svg")
                    .remove();

                runScript_mergedtree(h1, h2);


            });

        d3.select("#treeswolinking-tab")
            .on("click", function () {

                //console.log(window.h1);


                d3.select("#treeswlinking-tab")
                    .classed("active", false);

                d3.select("#treeswolinking-tab")
                    .classed("active", true);

                d3.select("#mergedtrees-tab")
                    .classed("active", false);



                d3.select("#content")
                    .select("#mergedtree_svg")
                    .remove();

                d3.select("#content")
                    .select("#treeswlinking_svg")
                    .remove();



                runScript_treeswolinking(h1, h2);

            });

        d3.select("#treeswlinking-tab")
            .on("click", function () {

                //console.log(window.h1);


                d3.select("#treeswlinking-tab")
                    .classed("active", true);

                d3.select("#treeswolinking-tab")
                    .classed("active", false);

                d3.select("#mergedtrees-tab")
                    .classed("active", false);

                d3.select("#content")
                    .select("#mergedtree_svg")
                    .remove();


                d3.select("#content")
                    .select("#treeswolinking_svg")
                    .remove();

                runScript_treeswlinking(h1, h2);

            });


        d3.select("#sideradio")
            .on("click", function () {
                d3.select("#treeswlinking_svg").remove();
                runScript_treeswlinking(h1, h2);
            });


        d3.select("#def_tbradio")
            .on("click", function () {
                d3.select("#treeswlinking_svg").remove();
                runScript_treeswlinking(h1, h2);
            });

        d3.select("#tbradio")
            .on("click", function () {
                d3.select("#treeswlinking_svg").remove();
                runScript_treeswlinking(h1, h2);
            });


        d3.select("#lrradio")
            .on("click", function () {
                d3.select("#treeswlinking_svg").remove();
                runScript_treeswlinking(h1, h2);
            });

        d3.select("#lrleavesradio")
            .on("click", function () {
                d3.select("#treeswlinking_svg").remove();
                runScript_treeswlinking(h1, h2);
            });

        d3.select("#tlbrradio")
            .on("click", function () {
                d3.select("#treeswlinking_svg").remove();
                runScript_treeswlinking(h1, h2);
            });




        d3.select("#ang_tlbrradio")
            .on("click", function () {
                d3.select("#treeswlinking_svg").remove();
                runScript_treeswlinking(h1, h2);
            });



        d3.select("#straightlradio")
            .on("click", function () {
                d3.select("#treeswlinking_svg").remove();
                runScript_treeswlinking(h1, h2);
            });


        d3.select("#curvedlradio")
            .on("click", function () {
                d3.select("#treeswlinking_svg").remove();
                runScript_treeswlinking(h1, h2);
            });



        function runScript_treeswlinking(h1, h2) {



            var radius = 0;


            if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                radius = 13;
            else radius = 18;

            var h1color = "", h2color = "", mergedcolor = "";

            if (d3.select("#blueredradio")._groups[0][0].checked == true) {
                h1color = "blue";
                h2color = "green";
                mergedcolor = "blue";
            }

            else if (d3.select("#orangeblueradio")._groups[0][0].checked == true) {
                h1color = "orange";
                h2color = "blue";
                mergedcolor = "yellowgreen";
            }



            var margin = { top: 30, right: 30, bottom: 30, left: 120 },
                width = 6000 - margin.left - margin.right,
                height = 3500 - margin.top - margin.bottom;

            var treeswlinking_svg = d3
                .select("#content")
                .append("svg")
                .attr("id", "treeswlinking_svg")
                .attr("width", width)
                .attr("height", height);



            stratify = d3
                .stratify()
                .id(function (d) {
                    return d.child;
                })
                .parentId(function (d) {
                    return d.parent;
                });

            var h2_struct = stratify(h2);
            //console.log(h2_struct);

            var h1_struct = stratify(h1);
            //console.log(h1_struct);


            var h1_root = d3.hierarchy(h1_struct);
            var h2_root = d3.hierarchy(h2_struct);


            if (d3.select("#filterdatacheck")._groups[0][0].checked == true) {
                h1_root = filterData(h1_root);
                h2_root = filterData(h2_root);
            }



            var tree;

            var h1_xpos = 5800;
            var h1_ypos = 3300;

            var h2_xpos = 50;
            var h2_ypos = 100;

            var ltree_size = [2800, 3000];
            var mtree_size = [2300, 2000];
            var stree_size = [1800, 1000];

            var h1_rot = 180;
            var h2_rot = 0;

            var lab_rot = 180;
            var h1_scalex = -1;
            var h1_scaley = 1;

            var h2_scalex = 0;
            var h2_scaley = 0;



            //console.log(h1_root.descendants().length);
            if (h1_root.descendants().length > 0 && h1_root.descendants().length <= 100)
                tree = d3
                    .tree()
                    .size(stree_size);
            else if (h1_root.descendants().length > 100 && h1_root.descendants().length <= 500)
                tree = d3
                    .tree()
                    .size(mtree_size);
            else if (h1_root.descendants().length > 500)
                tree = d3
                    .tree()
                    .size(ltree_size);



            //h1 tree is 
            //h2 tree is 

            if (d3.select("#sideradio")._groups[0][0].checked == true) {


                h1_xpos = 1700;
                h1_ypos = 1000;

                h2_xpos = 1800;
                h2_ypos = 1000;


                h1_rot = 0;
                h2_rot = 0;


            }


            if (d3.select("#def_tbradio")._groups[0][0].checked == true) {


                h1_xpos = 3000;
                h1_ypos = 3300;


            }

            else if (d3.select("#tbradio")._groups[0][0].checked == true) {


                h1_xpos = 500;
                h1_ypos = 1500;

                h2_xpos = 500;
                h2_ypos = 2000;
            }


            else if (d3.select("#tlbrradio")._groups[0][0].checked == true) {


                h1_xpos = 1800;
                h1_ypos = 3300;
            }


            else if (d3.select("#ang_tlbrradio")._groups[0][0].checked == true) {


                h1_xpos = 3300;
                h1_ypos = 2200;


                h2_xpos = 2650;
                h2_ypos = 1000;

                h1_rot = -30;
                h2_rot = 150;
            }


            else if (d3.select("#lrradio")._groups[0][0].checked == true) {


                h1_xpos = 2500;
                h1_ypos = 550;
                //h1_ypos = 2600;


                h2_xpos = 1500;
                h2_ypos = 550;

                h1_rot = 270;
                h2_rot = 90;

                lab_rot = 0;


            }

            else if (d3.select("#lrleavesradio")._groups[0][0].checked == true) {


                h1_xpos = 4500;
                h1_ypos = 2550;
                //h1_ypos = 2600;


                h2_xpos = 200;
                h2_ypos = 2450;

                h1_rot = 270;
                h2_rot = 90;


                h1_scalex = 1;
                h1_scaley = -1;


                h2_scalex = -1;
                h2_scaley = -1;

                lab_rot = 180;

                lab_scalex = 1;
                lab_scaley = -1;

            }






            var h1_tree = tree(h1_root);


            var data_nodes = h1_tree.descendants();

            //console.log(data_nodes);

            /*  data_nodes = data_nodes.filter(function (d) {
                 //console.log(d.children.length);
                 if (d.data.data.child.includes("A") || d.data.data.child.includes("B") || d.data.data.child.includes("C"))
                     return d;
            
             }); */

            //console.log(data_nodes);


            var data_links = h1_tree.links();

            /*  data_links = data_links.filter(function (d) {
                 //console.log(d);
                 if (d.source.data.data.child.includes("A") || d.source.data.data.child.includes("B") || d.source.data.data.child.includes("C"))
                     return d;
            
             }); */

            //console.log(data);


            var h1_node = treeswlinking_svg
                .append("g")
                .attr("id", "h1tree")
                .attr("transform", "translate(" + h1_xpos + "," + h1_ypos + ") rotate(" + h1_rot + ") scale(" + h1_scalex + "," + h1_scaley + ")")
                //.attr("transform", "translate(" + h1_xpos + "," + h1_ypos + ") rotate(" + h1_rot + " " + h1_xpos + " " + h1_ypos + ")")
                .selectAll(".h1_node")
                .data(data_nodes)
                //.data(h1_tree.descendants())
                .enter()
                .append("g")
                .attr("class", function (d) {
                    //   console.log(d);
                    return d.child;
                });



            /* treeswolinking_svg.select("#h1tree")
                .append("rect")
                .attr('x', -30)
                .attr('y', -30)
                .attr('width', 1400)
                .attr('height', 600)
                .attr('stroke', 'black')
                .attr('fill', 'none'); */


            var h1_link = h1_node
                .append("path")
                //.data(h1_tree.links())
                .data(data_links)
                // .enter()
                .attr("class", function (d) {
                    return "h1_link";
                })
                //.classed("link", true)
                .attr("d", function (d) {
                    return "M" + d.source.x + "," + d.source.y
                        + "C" + d.source.x + "," + (d.source.y + d.target.y) / 2
                        + " " + d.target.x + "," + (d.source.y + d.target.y) / 2
                        + " " + d.target.x + "," + (d.target.y);
                })
                .style("opacity", function (d) {
                    return 0.5;
                })
                //.style("stroke", "#ccc")
                .style("stroke", "green")
                .style("fill", "none")
                .style("stroke-width", "7px");

            h1_node
                .append("circle")
                .attr("cx", function (d) {
                    // console.log(d);
                    // console.log(radialPoint(d.x, d.y));
                    return d.x;
                })
                .attr("cy", function (d) {
                    return d.y;
                })
                .attr("r", function (d) {
                    //        console.log(radius);
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return (radius - 3) + "px";
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return (radius - 6) + "px";
                })
                .attr("class", function (d) {
                    return (
                        "node" + (d.children ? " node--internal" : " node--leaf")
                    );
                })
                .attr("id", function (d) {
                    return "h1tree_" + d.data.data.child
                        .replaceAll(/\//g, "")
                        .replaceAll(".", "")
                        .replaceAll(" ", "")
                        .replaceAll("(", "")
                        .replaceAll(")", "")
                        .toLowerCase();
                })
                .style("fill", function (d) {
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return h2color;
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return h1color;

                })
                // .style("opacity", 1)

                .style("opacity", function (d) {
                    return 0.3;
                })
                .on("mouseover", function (d, i) {
                    var name = d.data.data.child;
                    //console.log(name);
                    //if (name == undefined)
                    //name = d.data.data.child;
                    var text = "Element: <b>" + name + "</b><br>Element code: <b>" + d.data.data.child + "</b><br>Parent code: <b>" + d.data.data.parent + "</b>";
                    d3.select("#tooltip")
                        .html(text)
                        .style("left", parseInt(d3.event.pageX - 200) + "px")
                        .style("top", parseInt(d3.event.pageY + 50) + "px")
                        .style("text-align", "left")
                        .style("opacity", 1);

                    d3.select(this)
                        .transition()
                        .attr("r", 15);
                })
                .on("mouseleave", function (d) {

                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        d3.select(this)
                            .transition()
                            .attr("r", radius - 3);
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        d3.select(this)
                            .transition()
                            .attr("r", radius - 6);


                    d3.select("#tooltip")
                        .html("")
                        .style("left", 0)
                        .style("top", 0)
                        .style("opacity", 0);

                });

            h1_node
                .append("text")

                /* .attr("transform", function (d) {
                    var x = 0;
                    var y = 0;

                    if ((this.previousSibling).getAttribute("class").includes("leaf")) {
                        x = d.x - 8;
                        y = d.y;
                    }
                    else {
                        x = d.x - 10;
                        y = d.y;
                    }
                    return "rotate(" + lab_rot + "," + x + "," + y + ")";

                }) */

                .style("font-size", function (d) {
                    if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                        return "20px";
                    else
                        return "40px";
                })
                .attr("class", function (d) {
                    return d.data.data.child
                        .replaceAll(" ", "")
                        .replaceAll("(", "")
                        .replaceAll(")", "")
                        .toLowerCase();
                })
                .classed("text", true)
                .attr("dy", "2em")
                .attr("x", function (d) {

                    if ((this.previousSibling).getAttribute("class").includes("leaf"))
                        return d.x - 8;
                    else
                        return d.x + 10;
                })
                .attr("y", function (d) {
                    if ((this.previousSibling).getAttribute("class").includes("leaf"))
                        return d.y - 8;
                    else
                        return d.y - 30;
                })
                .attr("text-anchor", function (d) {
                    return "start";
                })

                .style("opacity", function (d) {
                    if (d3.select("#fileversion3radio")._groups[0][0].checked == true) {
                        if (d.depth <= 2)
                            return 1;
                        else
                            return 0;
                    }
                    else return 1;
                })
                .text(function (d) {
                    // console.log(d);
                    var label = "";
                    if (d.data.data.description)
                        label = d.data.data.description;
                    else
                        label = d.data.data.child;
                    if (label.includes("/"))
                        label = label.substring(label.lastIndexOf("/") + 1, label.length);
                    return label;
                });







            //////////////// TREESWLINKING H2

            var h2_tree = tree(h2_root);


            if (h2_scalex == 0 && h2_scaley == 0) {
                var h2_node = treeswlinking_svg
                    .append("g")
                    .attr("id", "h2tree")
                    .attr("transform", "translate(" + h2_xpos + "," + h2_ypos + ") rotate(" + h2_rot + ")")
                    //.attr("transform", "translate(" + h2_xpos + "," + h2_ypos + ") rotate(" + h2_rot + " " + h2_xpos + " " + h2_ypos + ")")
                    .selectAll(".h2_node")
                    .data(h2_tree.descendants())
                    .enter()
                    .append("g")
                    .attr("class", function (d) {
                        //   console.log(d);
                        return d.child;
                    });
            }
            else
                var h2_node = treeswlinking_svg
                    .append("g")
                    .attr("id", "h2tree")
                    .attr("transform", "translate(" + h2_xpos + "," + h2_ypos + ") rotate(" + h2_rot + ") scale(" + h2_scalex + "," + h2_scaley + ")")
                    //.attr("transform", "translate(" + h2_xpos + "," + h2_ypos + ") rotate(" + h2_rot + " " + h2_xpos + " " + h2_ypos + ")")
                    .selectAll(".h2_node")
                    .data(h2_tree.descendants())
                    .enter()
                    .append("g")
                    .attr("class", function (d) {
                        //   console.log(d);
                        return d.child;
                    });


            /* treeswolinking_svg.select("#h2tree")
                .append("rect")
                .attr('x', -30)
                .attr('y', -30)
                .attr('width', 1500)
                .attr('height', 600)
                .attr('stroke', 'black') 
                .attr('fill', 'none');
            */



            var h2_link = h2_node
                .append("path")
                .data(h2_tree.links())
                // .enter()
                .attr("class", function (d) {
                    return "h2_link";
                })
                //.classed("link", true)
                .attr("d", function (d) {
                    return "M" + d.source.x + "," + d.source.y
                        + "C" + d.source.x + "," + (d.source.y + d.target.y) / 2
                        + " " + d.target.x + "," + (d.source.y + d.target.y) / 2
                        + " " + d.target.x + "," + (d.target.y);
                })
                .style("opacity", function (d) {
                    return 0.3;
                })
                //.style("stroke", "#ccc")
                .style("stroke", "red")
                .style("fill", "none")
                .style("stroke-width", "7px");

            h2_node
                .append("circle")
                .attr("cx", function (d) {
                    // console.log(d);
                    // console.log(radialPoint(d.x, d.y));
                    return d.x;
                })
                .attr("cy", function (d) {
                    return d.y;
                })
                .attr("r", function (d) {
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return radius + "px";
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return (radius - 4) + "px";
                })
                .attr("class", function (d) {
                    return (
                        "node" + (d.children ? " node--internal" : " node--leaf")
                    );
                })
                .attr("id", function (d) {
                    return "h2tree_" + d.data.data.child
                        .replaceAll(/\//g, "")
                        .replaceAll(".", "")
                        .replaceAll(" ", "")
                        .replaceAll("(", "")
                        .replaceAll(")", "")
                        .toLowerCase();
                })
                .style("fill", function (d) {
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return h1color;
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return "white";
                })
                .style("stroke", function (d) {
                    //console.log(h1color);
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return "none";
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return h1color;

                })
                .style("stroke-width", function (d) {
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return "0px";
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return "5px";

                })

                .style("opacity", function (d) {
                    return 0.3;
                })
                .on("mouseover", function (d, i) {
                    var text = "Element: <b>" + d.data.data.description + "</b><br>Element code: <b>" + d.data.data.child + "</b><br>Parent code: <b>" + d.data.data.parent + "</b>";
                    d3.select("#tooltip")
                        .html(text)

                        .style("left", parseInt(d3.event.pageX - 200) + "px")
                        .style("top", parseInt(d3.event.pageY + 50) + "px")
                        .style("text-align", "left")
                        .style("opacity", 1);

                    d3.select(this)
                        .transition()
                        .attr("r", 15);
                })
                .on("mouseleave", function (d) {

                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        d3.select(this)
                            .transition()
                            .attr("r", radius - 3);
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        d3.select(this)
                            .transition()
                            .attr("r", radius - 6);


                    d3.select("#tooltip")
                        .html("")
                        .style("left", 0)
                        .style("top", 0)
                        .style("opacity", 0);

                });



            h2_node
                .append("text")
                .style("font-size", function (d) {
                    if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                        return "20px";
                    else
                        return "40px";
                })
                .attr("class", function (d) {
                    return d.data.data.child
                        .replaceAll(" ", "")
                        .replaceAll("(", "")
                        .replaceAll(")", "")
                        .toLowerCase();
                })
                .classed("text", true)
                .attr("dy", "2em")
                .attr("x", function (d) {

                    //console.log(d3.select(this.parentNode)._groups[0][0].children[1].getAttribute("class"));
                    if (d3.select(this.parentNode)._groups[0][0].children[1].getAttribute("class").includes("leaf"))
                        return d.x - 8;
                    else
                        return d.x + 20;
                })
                .attr("y", function (d) {
                    //if ((this.previousSibling).getAttribute("class").includes("leaf"))
                    if (d3.select(this.parentNode)._groups[0][0].children[1].getAttribute("class").includes("leaf"))
                        return d.y - 8;
                    else
                        return d.y - 30;
                })
                .attr("text-anchor", function (d) {
                    return "start";
                })

                .style("opacity", function (d) {
                    //  console.log(d);
                    if (d.depth <= 4)
                        return 1;
                    else
                        return 0;
                })
                .text(function (d) {
                    // console.log(d);
                    var label = "";
                    if (d.data.data.description)
                        label = d.data.data.description;
                    else
                        label = d.data.data.child;
                    if (label.includes("/"))
                        label = label.substring(label.lastIndexOf("/") + 1, label.length);
                    return label;
                });




            //console.log()
            //console.log(h1_tree.descendants());
            //console.log(h2_tree.descendants());

            var x1 = 0, x2 = 0, y1 = 0, y2 = 0;


            d3
                .select("#treeswlinking_svg")
                .append("g")
                .attr("id", "lines");

            for (var h1 = 0; h1 < h1_tree.descendants().length; h1++) {
                for (var h2 = 0; h2 < h2_tree.descendants().length; h2++) {
                    if (h1_tree.descendants()[h1].data.data.child == h2_tree.descendants()[h2].data.data.child) {
                        //console.log(h2_tree.descendants()[h2].data.data.child + " " + h1_tree.descendants()[h1].data.data.child);
                        //console.log(document.getElementById("h1tree_" + h1_tree.descendants()[h1].data.data.child.toLowerCase()));
                        //console.log(document.getElementById("h2tree_" + h2_tree.descendants()[h2].data.data.child.toLowerCase()));


                        x1 = document.getElementById("h1tree_" + h1_tree.descendants()[h1].data.data.child.toLowerCase()).getAttribute("cx");
                        y1 = document.getElementById("h1tree_" + h1_tree.descendants()[h1].data.data.child.toLowerCase()).getAttribute("cy");

                        x2 = document.getElementById("h2tree_" + h2_tree.descendants()[h2].data.data.child.toLowerCase()).getAttribute("cx");
                        y2 = document.getElementById("h2tree_" + h2_tree.descendants()[h2].data.data.child.toLowerCase()).getAttribute("cy");



                        //console.log(x2 + " , " + y2);

                        var ctm1 = document.getElementById("h1tree_" + h1_tree.descendants()[h1].data.data.child.toLowerCase()).getCTM();
                        var ctm2 = document.getElementById("h2tree_" + h1_tree.descendants()[h1].data.data.child.toLowerCase()).getCTM();


                        //console.log(ctm2.a + " " + ctm2.b + " " + ctm2.c + " " + ctm2.d + " " + ctm2.e + " " + ctm2.f);

                        // if (d3.select("#lrradio")._groups[0][0].checked == true) {

                        //console.log(parseInt(x2) + " " + ctm2.b);
                        //console.log(parseInt(y2) + " " + ctm2.d);
                        //console.log(ctm2.f + " ");

                        var upd_x1 = (parseInt(x1) * ctm1.a) + (parseInt(y1) * ctm1.c) + ctm1.e;
                        var upd_y1 = (parseInt(x1) * ctm1.b) + (parseInt(y1) * ctm1.d) + ctm1.f;

                        var upd_x2 = (parseInt(x2) * ctm2.a) + (parseInt(y2) * ctm2.c) + ctm2.e;
                        var upd_y2 = (parseInt(x2) * ctm2.b) + (parseInt(y2) * ctm2.d) + ctm2.f;

                        //console.log(x1 + " , " + y1);
                        //console.log(parseInt(x2) * ctm2.b);

                        //console.log(x2 + " , " + upd_y2);

                        // }

                        /* else {
                            var upd_x1 = h1_xpos - parseInt(x1);
                            var upd_y1 = h1_ypos - parseInt(y1);

                            var upd_x2 = parseInt(x2) + h2_xpos;
                            var upd_y2 = parseInt(y2) + h2_ypos;


                        } */




                        //console.log(x1 + " , " + y1);
                        //console.log(x2 + " , " + y2);


                        /*  d3
                             .select("#treeswlinking_svg")
                             .select("#lines")
                             .append("circle")
                             .attr("class", h1_tree.descendants()[h1].data.data.child)
                             .attr("cx", upd_x2)
                             .attr("cy", upd_y2)
                             .attr("r", 20)
                             .style("stroke", "green")
                             .style("fill", "yellow")
                             .style("stroke-width", 5); */

                        points = [];
                        points.push([upd_x1, upd_y1]);
                        points.push([(upd_x1 + upd_x2) / 2, (upd_y1 + upd_y2) / 2 - 200]);
                        points.push([upd_x2, upd_y2]);

                        //console.log(points);



                        //console.log(d3.select("#h1tree").attr("transform"));
                        //console.log(d3.select("#h2tree").attr("transform"));

                        //console.log(document.getElementById("h1tree_" + h1_tree.descendants()[h1].data.data.child).getBoundingClientRect());
                        //console.log(document.getElementById("h2tree_" + h1_tree.descendants()[h1].data.data.child).getBoundingClientRect());


                        //console.log(document.getElementById("h1tree_" + h1_tree.descendants()[h1].data.data.child).getBBox());
                        //console.log(document.getElementById("h2tree_" + h1_tree.descendants()[h1].data.data.child).getBBox());



                        if (d3.select("#straightlradio")._groups[0][0].checked == true) {
                            var pathline = d3.line(points);




                            d3
                                .select("#treeswlinking_svg")
                                .select("#lines")
                                .append("line")
                                .style("stroke", "blue")
                                .style("fill", "none")
                                .style("stroke-width", 7)
                                .style("opacity", 0.3)
                                //.attr("x1", "transform(" + points[0] + "," + [0] + ")")
                                .attr("x1", upd_x1)
                                .attr("y1", upd_y1)
                                .attr("x2", upd_x2)
                                .attr("y2", upd_y2);

                        }



                        else if (d3.select("#curvedlradio")._groups[0][0].checked == true) {

                            var pathcurve = d3.line().curve(d3.curveBasis);




                            d3
                                .select("#treeswlinking_svg")
                                .select("#lines")
                                .append("path")
                                .attr("d", pathcurve(points))
                                .style("stroke", "green")
                                .style("fill", "none")
                                .style("stroke-width", 5);

                        }




                        //console.log(d3.select("h1tree_" + h1_tree.descendants()[h1].data.data.child).attr("cx"));



                    }

                }

            }













        }





        function runScript_treeswolinking(h1, h2) {



            var radius = 0;

            if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                radius = 13;
            else radius = 18;

            var h1color = "", h2color = "", mergedcolor = "";

            if (d3.select("#blueredradio")._groups[0][0].checked == true) {
                h1color = "blue";
                h2color = "green";
                mergedcolor = "blue";
            }

            else if (d3.select("#orangeblueradio")._groups[0][0].checked == true) {
                h1color = "orange";
                h2color = "blue";
                mergedcolor = "yellowgreen";
            }



            var margin = { top: 30, right: 30, bottom: 30, left: 120 },
                width = 6000 - margin.left - margin.right,
                height = 3500 - margin.top - margin.bottom;

            var treeswolinking_svg = d3
                .select("#content")
                .append("svg")
                .attr("id", "treeswolinking_svg")
                .attr("width", width)
                .attr("height", height);



            stratify = d3
                .stratify()
                .id(function (d) {
                    return d.child;
                })
                .parentId(function (d) {
                    return d.parent;
                });

            var h2_struct = stratify(h2);
            //console.log(h2_struct);

            var h1_struct = stratify(h1);
            //console.log(h1_struct);


            var h1_root = d3.hierarchy(h1_struct);
            var h2_root = d3.hierarchy(h2_struct);


            if (d3.select("#filterdatacheck")._groups[0][0].checked == true) {
                h1_root = filterData(h1_root);
                h2_root = filterData(h2_root);
            }




            var tree = d3
                .tree()
                //.nodeSize([]);
                .size([2300, 3000]);



            var h1_tree = tree(h1_root);


            var data_nodes = h1_tree.descendants();

            //console.log(data_nodes);

            /*  data_nodes = data_nodes.filter(function (d) {
                 //console.log(d.children.length);
                 if (d.data.data.child.includes("A") || d.data.data.child.includes("B") || d.data.data.child.includes("C"))
                     return d;
 
             }); */

            //console.log(data_nodes);


            var data_links = h1_tree.links();

            /*  data_links = data_links.filter(function (d) {
                 //console.log(d);
                 if (d.source.data.data.child.includes("A") || d.source.data.data.child.includes("B") || d.source.data.data.child.includes("C"))
                     return d;
 
             }); */

            //console.log(data);


            var h1_node = treeswolinking_svg
                .append("g")
                .attr("id", "h1tree")
                .attr("transform", "translate(" + 2500 + "," + 100 + ")")
                .selectAll(".h1_node")
                .data(data_nodes)
                //.data(h1_tree.descendants())
                .enter()
                .append("g")
                .attr("class", function (d) {
                    //   console.log(d);
                    return d.child;
                });

            /* treeswolinking_svg.select("#h1tree")
                .append("rect")
                .attr('x', -30)
                .attr('y', -30)
                .attr('width', 1400)
                .attr('height', 600)
                .attr('stroke', 'black')
                .attr('fill', 'none'); */


            var h1_link = h1_node
                .append("path")
                //.data(h1_tree.links())
                .data(data_links)
                // .enter()
                .attr("class", function (d) {
                    return "h1_link";
                })
                //.classed("link", true)
                .attr("d", function (d) {
                    return "M" + d.source.x + "," + d.source.y
                        + "C" + d.source.x + "," + (d.source.y + d.target.y) / 2
                        + " " + d.target.x + "," + (d.source.y + d.target.y) / 2
                        + " " + d.target.x + "," + (d.target.y);
                })
                .style("opacity", function (d) {
                    return 0.5;
                })
                //.style("stroke", "#ccc")
                .style("stroke", "green")
                .style("fill", "none")
                .style("stroke-width", "7px");

            h1_node
                .append("circle")
                .attr("cx", function (d) {
                    // console.log(d);
                    // console.log(radialPoint(d.x, d.y));
                    return d.x;
                })
                .attr("cy", function (d) {
                    return d.y;
                })
                .attr("r", function (d) {
                    //        console.log(radius);
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return (radius - 3) + "px";
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return (radius - 6) + "px";
                })
                .attr("class", function (d) {
                    return (
                        "node" + (d.children ? " node--internal" : " node--leaf")
                    );
                })
                .attr("id", function (d) {
                    return "h1tree_" + d.data.data.child
                        .replaceAll(/\//g, "")
                        .replaceAll(".", "")
                        .replaceAll(" ", "")
                        .replaceAll("(", "")
                        .replaceAll(")", "")
                        .toLowerCase();
                })
                .style("fill", function (d) {


                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return h2color;
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return h1color;

                })
                // .style("opacity", 1)

                .style("opacity", function (d) {
                    return 0.3;
                })
                .on("mouseover", function (d, i) {
                    var name = d.data.data.child;
                    //console.log(name);
                    //if (name == undefined)
                    //name = d.data.data.child;
                    var text = "Element: <b>" + name + "</b><br>Element code: <b>" + d.data.data.child + "</b><br>Parent code: <b>" + d.data.data.parent + "</b>";

                    d3.select("#tooltip")
                        .html(text)

                        .style("left", parseInt(d3.event.pageX - 200) + "px")
                        .style("top", parseInt(d3.event.pageY + 50) + "px")
                        .style("text-align", "left")
                        .style("opacity", 1);

                    d3.select(this)
                        .transition()
                        .attr("r", 15);
                })
                .on("mouseleave", function (d) {

                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        d3.select(this)
                            .transition()
                            .attr("r", radius - 3);
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        d3.select(this)
                            .transition()
                            .attr("r", radius - 6);


                    d3.select("#tooltip")
                        .html("")
                        .style("left", 0)
                        .style("top", 0)
                        .style("opacity", 0);

                });

            h1_node
                .append("text")
                .style("font-size", function (d) {
                    if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                        return "20px";
                    else
                        return "40px";
                })
                .attr("class", function (d) {
                    return d.data.data.child
                        .replaceAll(" ", "")
                        .replaceAll("(", "")
                        .replaceAll(")", "")
                        .toLowerCase();
                })
                .classed("text", true)
                .attr("dy", "2em")
                .attr("x", function (d) {

                    if ((this.previousSibling).getAttribute("class").includes("leaf"))
                        return d.x - 8;
                    else
                        return d.x + 10;
                })
                .attr("y", function (d) {
                    if ((this.previousSibling).getAttribute("class").includes("leaf"))
                        return d.y - 8;
                    else
                        return d.y - 30;
                })
                .attr("text-anchor", function (d) {
                    return "start";
                })

                .style("opacity", function (d) {
                    if (d3.select("#fileversion3radio")._groups[0][0].checked == true) {
                        if (d.depth <= 2)
                            return 1;
                        else
                            return 0;
                    }
                    else return 1;
                })
                .text(function (d) {
                    //console.log(d.data.data.description);
                    var label = "";
                    if (d.data.data.description)
                        label = d.data.data.description;
                    else
                        label = d.data.data.child;
                    if (label.includes("/"))
                        label = label.substring(label.lastIndexOf("/") + 1, label.length);
                    return label;
                });







            //////////////// TREESWOLINKING H2

            var h2_tree = tree(h2_root);


            var h2_node = treeswolinking_svg
                .append("g")
                .attr("id", "h2tree")
                .attr("transform", "translate(" + 50 + "," + 100 + ")")
                .selectAll(".h2_node")
                .data(h2_tree.descendants())
                .enter()
                .append("g")
                .attr("class", function (d) {
                    //   console.log(d);
                    return d.child;
                });

            /* treeswolinking_svg.select("#h2tree")
                .append("rect")
                .attr('x', -30)
                .attr('y', -30)
                .attr('width', 1500)
                .attr('height', 600)
                .attr('stroke', 'black') 
                .attr('fill', 'none');
*/



            var h2_link = h2_node
                .append("path")
                .data(h2_tree.links())
                // .enter()
                .attr("class", function (d) {
                    return "h2_link";
                })
                //.classed("link", true)
                .attr("d", function (d) {
                    return "M" + d.source.x + "," + d.source.y
                        + "C" + d.source.x + "," + (d.source.y + d.target.y) / 2
                        + " " + d.target.x + "," + (d.source.y + d.target.y) / 2
                        + " " + d.target.x + "," + (d.target.y);
                })
                .style("opacity", function (d) {
                    return 0.3;
                })
                //.style("stroke", "#ccc")
                .style("stroke", "red")
                .style("fill", "none")
                .style("stroke-width", "7px");

            h2_node
                .append("circle")
                .attr("cx", function (d) {
                    // console.log(d);
                    // console.log(radialPoint(d.x, d.y));
                    return d.x;
                })
                .attr("cy", function (d) {
                    return d.y;
                })
                .attr("r", function (d) {
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return radius + "px";
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return (radius - 4) + "px";
                })
                .attr("class", function (d) {
                    return (
                        "node" + (d.children ? " node--internal" : " node--leaf")
                    );
                })
                .attr("id", function (d) {
                    return "h2tree_" + d.data.data.child
                        .replaceAll(/\//g, "")
                        .replaceAll(".", "")
                        .replaceAll(" ", "")
                        .replaceAll("(", "")
                        .replaceAll(")", "")
                        .toLowerCase();
                })
                .style("fill", function (d) {
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return h1color;
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return "white";
                })
                .style("stroke", function (d) {
                    //console.log(h1color);
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return "none";
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return h1color;

                })
                .style("stroke-width", function (d) {
                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        return "0px";
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        return "5px";

                })

                .style("opacity", function (d) {
                    return 0.3;
                })
                .on("mouseover", function (d, i) {
                    var name = d.data.data.child;
                    //console.log(name);
                    //if (name == undefined)
                    //name = d.data.data.child;
                    var text = "Element: <b>" + name + "</b><br>Element code: <b>" + d.data.data.child + "</b><br>Parent code: <b>" + d.data.data.parent + "</b>";
                    d3.select("#tooltip")
                        .html(text)

                        .style("left", parseInt(d3.event.pageX - 200) + "px")
                        .style("top", parseInt(d3.event.pageY + 50) + "px")
                        .style("text-align", "left")
                        .style("opacity", 1);

                    d3.select(this)
                        .transition()
                        .attr("r", 15);
                })
                .on("mouseleave", function (d) {

                    if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                        d3.select(this)
                            .transition()
                            .attr("r", radius - 3);
                    if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                        d3.select(this)
                            .transition()
                            .attr("r", radius - 6);


                    d3.select("#tooltip")
                        .html("")
                        .style("left", 0)
                        .style("top", 0)
                        .style("opacity", 0);

                });



            h2_node
                .append("text")
                .style("font-size", function (d) {
                    if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                        return "20px";
                    else
                        return "40px";
                })
                .attr("class", function (d) {
                    return d.data.data.child
                        .replaceAll(" ", "")
                        .replaceAll("(", "")
                        .replaceAll(")", "")
                        .toLowerCase();
                })
                .classed("text", true)
                .attr("dy", "2em")
                .attr("x", function (d) {

                    //console.log(d3.select(this.parentNode)._groups[0][0].children[1].getAttribute("class"));
                    if (d3.select(this.parentNode)._groups[0][0].children[1].getAttribute("class").includes("leaf"))
                        return d.x - 8;
                    else
                        return d.x + 20;
                })
                .attr("y", function (d) {
                    //if ((this.previousSibling).getAttribute("class").includes("leaf"))
                    if (d3.select(this.parentNode)._groups[0][0].children[1].getAttribute("class").includes("leaf"))
                        return d.y - 8;
                    else
                        return d.y - 30;
                })
                .attr("text-anchor", function (d) {
                    return "start";
                })

                .style("opacity", function (d) {
                    //  console.log(d);
                    if (d.depth <= 4)
                        return 1;
                    else
                        return 0;
                })
                .text(function (d) {
                    var label = "";
                    if (d.data.data.description)
                        label = d.data.data.description;
                    else
                        label = d.data.data.child;
                    if (label.includes("/"))
                        label = label.substring(label.lastIndexOf("/") + 1, label.length);
                    return label;
                });






        }

        function filterData(array) {
            for (var i = array.children.length - 1; i >= 0; i--) {

                if (!(array.children[i].data.data.child === 'A' || array.children[i].data.data.child === 'B' || array.children[i].data.data.child === 'C'))
                    array.children.splice(i, 1);

            }

            return array;
        }

        function runScript_mergedtree(h1, h2) {
            //console.log("MERGEDTREE");

            //console.log(h1);
            //console.log(h2);

            d3.select("#content").select("svg").remove();

            var radius = 0;

            if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                radius = 10;
            else radius = 15;


            d3.select("#solidhollowcircle")
                .append("circle")
                .attr("cx", 500)
                .attr("cy", 500)
                .attr("r", 500)
                .style("fill", "blue")
                .style("stroke-width", "30px")
                .style("stroke", "red");


            //mergedtree size
            var margin = { top: 30, right: 30, bottom: 30, left: 120 },
                width = 6000 - margin.left - margin.right,
                height = 4500 - margin.top - margin.bottom;

            var mergedtree_svg = d3
                .select("#content")
                .append("svg")
                .attr("id", "mergedtree_svg")
                /*
                .call(d3.zoom().on("zoom", function () {
                    mergedtree_svg.attr("transform", d3.event.transform)
                }))
                */
                .attr("width", width)
                .attr("height", height);




            if (d3.select("#tooltip").empty())
                d3.select("#content")
                    .append("div")
                    .style("width", "400px")
                    .style("height", "250px")
                    //.style("width", "850px")
                    //.style("height", "350px")
                    .style("position", "absolute")
                    .style("opacity", 0)
                    .attr("id", "tooltip")
                    .style("background-color", "white")
                    .style("border", "solid")
                    .style("font-size", "40px")
                    //.style("font", "40px times")
                    .style("border-width", "3px")
                    .style("border-radius", "15px")
                    .style("padding", "15px");


            const depthArray = [];

            //console.log(h1);
            //console.log(h2);

            stratify = d3
                .stratify()
                .id(function (d) {
                    //console.log(d.child);
                    return d.child;
                })
                .parentId(function (d) {
                    //console.log(d.parent);
                    return d.parent;
                });

            //console.log(window.h2);
            var h2_struct = stratify(h2);
            console.log(h2_struct.children);


            var h1_struct = stratify(h1);
            //console.log(h1_struct);



            var h1_root = d3.hierarchy(h1_struct);
            var h2_root = d3.hierarchy(h2_struct);

            //console.log(h2_root.children);

            if (d3.select("#filterdatacheck")._groups[0][0].checked == true) {
                h1_root = filterData(h1_root);
                h2_root = filterData(h2_root);
            }

            //console.log(h2_root.children);

            //console.log(h1_rootElement.descendants());
            //console.log(h2_rootElement.descendants());

            //console.log(h1_root.descendants());



            var h1_dims = findDimensions(h1_root);
            var h2_dims = findDimensions(h2_root);

            //console.log(h1_dims);

            var h1color = "", h2color = "", mergedcolor = "";

            if (d3.select("#blueredradio")._groups[0][0].checked == true) {
                h1color = "blue";
                h2color = "green";
                mergedcolor = "blue";
            }

            else if (d3.select("#orangeblueradio")._groups[0][0].checked == true) {
                h1color = "orange";
                h2color = "blue";
                mergedcolor = "yellowgreen";
            }

            //console.log(h2_root.children);

            //no h1 and h2 trees
            h1tree(h1_root);
            h2tree(h2_root);


            //var arrDims = compareDimensions(h1_dims, h2_dims);
            //var hier = createHierarchy(arrDims, h1_root.descendants(), h2_root.descendants());


            var hier_arr = [];
            //hier_arr = compareDimensions(h1_dims, h2_dims, h1_root.descendants(), h2_root.descendants());
            hier_arr = bt_compareDimensions(h1_dims, h2_dims, h1_root.descendants(), h2_root.descendants());
            //console.log(hier_arr);


            var hier_struct = stratify(hier_arr);

            //mergedtree size
            width = 5000, height = 4500;

            var hier_root = d3.hierarchy(hier_struct);

            //console.log(hier_root);

            var tree = d3
                .tree()
                //.nodeSize([200, 600]);
                .size([width, height]);


            var cluster = d3
                .cluster()
                //.nodeSize([200, 600]);
                .size([width, height]);

            //console.log(hier_root);


            //if (d3.select("#leavesdiffheightradio")._groups[0][0].checked == true)
            mtree = tree(hier_root);
            //else if (d3.select("#leavessameheightradio")._groups[0][0].checked == true)
            //mtree = cluster(hier_root);

            //var data = mtree;




            mergedtree_svg
                .append("g")
                .attr("id", "mergedtree")
                .attr("transform",
                    "translate(" + (margin.left + 40) + "," + (margin.top + 800) + ")");






            /*
            
                        for (var m = mtree.descendants().length - 1; m >= 0; m--) {
                            //console.log(mtree.descendants()[m].data.data.child + " " + m);
                            mtree.descendants()[m].data.data.x = mtree.descendants()[m].x;
                            mtree.descendants()[m].data.data.y = mtree.descendants()[m].y;
                            //if (d.data.data.parent == d.data.data.alternateparent && d.data.data.level == d.data.data.alternatelevel) {
                            if (mtree.descendants()[m].data.data.parent == mtree.descendants()[m].data.data.alternateparent && mtree.descendants()[m].position != "expand") {
                                mtree.descendants()[m].childrenposition = "collapse";
                                mtree.descendants()[m].position = "collapse";
                                //console.log(d.data.data.child + " all same");
                            }
                            else {
                                //console.log("diff");
                                for (let i = 0; i < mtree.descendants()[m].ancestors().length; i++) {
                                    mtree.descendants()[m].ancestors()[i].position = "expand";
                                    mtree.descendants()[m].childrenposition = "expand";
                                    //console.log(mtree.descendants()[m].ancestors()[i].data.data.child);
                                }
                                //d.position = "expand";
                            }
            
                        }
            
            
                        mtree.descendants().forEach(function (d) {
                            if (d.childrenposition == "expand") {
                                if (d.children)
                                    for (var i = 0; i < d.children.length; i++)
                                        d.children[i].position = "expand";
                            }
                            //console.log(d.data.data.child + " " + d.position + " " + d.childrenposition);
            
                        });
            
            */


            //console.log(mtree.descendants());

            var flag = 0;
            mtree.descendants().reverse().forEach(function (element) {
                flag = 0;
                //console.log(element.data.data.child);
                if ((element.data.data.linkcolor == "blue") || element.children == null) {
                    for (var i = 0; i < element.descendants().length; i++) {
                        //console.log("entering check" + element.descendants()[i].data.data.child);
                        if ((element.descendants()[i].data.data.linkcolor == "blue") && element.descendants()[i].children == null) {
                            //console.log(element.descendants()[i].data.data.child + " passed check");
                            flag += 1;
                        }
                    }
                    //console.log(element.data.data.child + " " + flag + " " + (element.descendants().length));
                    if (flag == element.descendants().length - 1 || element.children == null) {
                        //console.log("collapse " + element.data.data.child);
                        collapse(element);
                    }
                    else {
                        //console.log("expand " + element.data.data.child + " " + flag + " " + element.descendants().length);
                    }
                }
                //else
                // console.log("expandedpc  " + element.data.data.child + " " + element.data.data.linkcolor + " " + element.children.length);
            });




            //console.log(mtree.descendants()[0]);

            mergedtree(mtree.descendants()[0]);


            d3.select("#filterdatacheck").on("change", function () {
                runScript_mergedtree(h1, h2);
            });


            d3.select("#blueredradio").on("change", function () {
                if (d3.select("#blueredradio")._groups[0][0].checked == true) {
                    h1color = "blue";
                    h2color = "green";
                    mergedcolor = "blue";
                }
                runScript_mergedtree(h1, h2);
                //h1tree(h1_root);
                //h2tree(h2_root);
                //hier_arr = compareDimensions(h1_dims, h2_dims, h1_root.descendants(), h2_root.descendants());
                //mergedtree(mtree.descendants(), mtree.links());
            });

            d3.select("#orangeblueradio").on("change", function () {
                if (d3.select("#orangeblueradio")._groups[0][0].checked == true) {
                    h1color = "orange";
                    h2color = "blue";
                    mergedcolor = "yellowgreen";
                }
                runScript_mergedtree(h1, h2);
                //h1tree(h1_root);
                //h2tree(h2_root);
                //hier_arr = compareDimensions(h1_dims, h2_dims, h1_root.descendants(), h2_root.descendants());
                //mergedtree(mtree.descendants(), mtree.links());

            });


            /* d3.select("#redgreenradio").on("change", function () {
                if (d3.select("#redgreenradio")._groups[0][0].checked == true) {
                    h1color = "green";
                    h2color = "green";
                    mergedcolor = "#a52a2a";
                }
                h1tree(h1_root);
                h2tree(h2_root);
                hier_arr = compareDimensions(h1_dims, h2_dims, h1_root.descendants(), h2_root.descendants());
                //hier_arr = flatten_array(hier);
                hier_struct = stratify(hier_arr);
                mergedtree(mtree.descendants(), mtree.links());
            }); */

            d3.select("#solidshaperadio").on("change", function () {
                h1tree(h1_root);
                h2tree(h2_root);
                mergedtree(mtree.descendants(), mtree.links());
            });

            d3.select("#hollowshaperadio").on("change", function () {
                h1tree(h1_root);
                h2tree(h2_root);
                mergedtree(mtree.descendants(), mtree.links());
            });

            d3.select("#leavessameheightradio").on("change", function () {
                runScript_mergedtree(h1, h2);
                //mergedtree(mtree.descendants(), mtree.links());
            });

            d3.select("#leavesdiffheightradio").on("change", function () {
                runScript_mergedtree(h1, h2);
                //mergedtree(mtree.descendants(), mtree.links());
            });

            d3.select("#hidenodesradio").on("change", function () {
                mergedtree(mtree.descendants(), mtree.links());
            });

            d3.select("#hidenodesedgesradio").on("change", function () {
                mergedtree(mtree.descendants(), mtree.links());
            });

            d3.select("#shownodesradio").on("change", function () {
                mergedtree(mtree.descendants(), mtree.links());
            });


            d3.select("#fillcolorradio").on("change", function () {
                mergedtree(mtree.descendants(), mtree.links());
            });

            d3.select("#fillnoneradio").on("change", function () {
                mergedtree(mtree.descendants(), mtree.links());
            });



            mergedtree_svg
                .append("g")
                .attr("class", "titleg");

            mergedtree_svg
                .select(".titleg")
                .selectAll("text")
                .data(title)
                .enter()
                .append("text")
                .style("font-size", "40px")
                .attr("dy", "2em")
                .attr("x", function (d, i) {
                    if (i == 0)
                        return 50;
                    else if (i == 1)
                        return 3300;
                    else
                        return 160;

                })
                .attr("y", function (d, i) {
                    if (i == 0 || i == 1)
                        return -30;
                    else
                        return 650;

                })
                .attr("text-anchor", function (d) {
                    return "start";
                })

                .style("opacity", 1)
                .text(function (d) {

                    return d;
                });








            /* START OF H1 TREE */


            function h1tree(h1_root, tabname) {

                //    console.log(h1color + " " + h2color + " " + mergedcolor);
                //console.log("H1 TREE");
                d3.select("#h1tree").remove();

                var h1tree = d3
                    .tree()
                    //.nodeSize([]);
                    .size([1300, 500]);



                var h1_tree = h1tree(h1_root);


                var data_nodes = h1_tree.descendants();

                //console.log(data_nodes);

                /*  data_nodes = data_nodes.filter(function (d) {
                     //console.log(d.children.length);
                     if (d.data.data.child.includes("A") || d.data.data.child.includes("B") || d.data.data.child.includes("C"))
                         return d;
 
                 }); */

                //console.log(data_nodes);


                var data_links = h1_tree.links();

                /*  data_links = data_links.filter(function (d) {
                     //console.log(d);
                     if (d.source.data.data.child.includes("A") || d.source.data.data.child.includes("B") || d.source.data.data.child.includes("C"))
                         return d;
 
                 }); */

                //console.log(data);


                var h1_node = mergedtree_svg
                    .append("g")
                    .attr("id", "h1tree")
                    .attr("transform", "translate(" + 3300 + "," + 100 + ")")
                    .selectAll(".h1_node")
                    .data(data_nodes)
                    //.data(h1_tree.descendants())
                    .enter()
                    .append("g")
                    .attr("class", function (d) {
                        //   console.log(d);
                        return d.child;
                    });

                mergedtree_svg.select("#h1tree")
                    .append("rect")
                    .attr('x', -30)
                    .attr('y', -30)
                    .attr('width', 1400)
                    .attr('height', 600)
                    .attr('stroke', 'black')
                    .attr('fill', 'none');


                var h1_link = h1_node
                    .append("path")
                    //.data(h1_tree.links())
                    .data(data_links)
                    // .enter()
                    .attr("class", function (d) {
                        return "h1_link";
                    })
                    //.classed("link", true)
                    .attr("d", function (d) {
                        return "M" + d.source.x + "," + d.source.y
                            + "C" + d.source.x + "," + (d.source.y + d.target.y) / 2
                            + " " + d.target.x + "," + (d.source.y + d.target.y) / 2
                            + " " + d.target.x + "," + (d.target.y);
                    })
                    .style("opacity", function (d) {
                        return 0.5;
                    })
                    //.style("stroke", "#ccc")
                    .style("stroke", "green")
                    .style("fill", "none")
                    .style("stroke-width", "5px");

                h1_node
                    .append("circle")
                    .attr("cx", function (d) {
                        // console.log(d);
                        // console.log(radialPoint(d.x, d.y));
                        return d.x;
                    })
                    .attr("cy", function (d) {
                        return d.y;
                    })
                    .attr("r", function (d) {
                        //        console.log(radius);
                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                            return (radius - 3) + "px";
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                            return (radius - 6) + "px";
                    })
                    .attr("class", function (d) {
                        return (
                            "node" + (d.children ? " node--internal" : " node--leaf")
                        );
                    })
                    .attr("id", function (d) {
                        return "h1tree_" + d.data.data.child
                            .replaceAll(/\//g, "")
                            .replaceAll(".", "")
                            .replaceAll(" ", "")
                            .replaceAll("(", "")
                            .replaceAll(")", "")
                            .toLowerCase();
                    })
                    .style("fill", function (d) {
                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                            return h2color;
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                            return h1color;

                    })
                    // .style("opacity", 1)

                    .style("opacity", function (d) {
                        return 0.3;
                    })
                    .on("mouseover", function (d, i) {
                        var name = d.data.data.child;
                        //console.log(name);
                        //if (name == undefined)
                        //name = d.data.data.child;
                        var text = "Element: <b>" + name + "</b><br>Element code: <b>" + d.data.data.child + "</b><br>Parent code: <b>" + d.data.data.parent + "</b>";
                        d3.select("#tooltip")
                            .html(text)

                            .style("left", parseInt(d3.event.pageX - 200) + "px")
                            .style("top", parseInt(d3.event.pageY + 50) + "px")
                            .style("text-align", "left")
                            .style("opacity", 1);

                        d3.select(this)
                            .transition()
                            .attr("r", 18);
                    })
                    .on("mouseleave", function (d) {

                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                            d3.select(this)
                                .transition()
                                .attr("r", radius - 3);
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                            d3.select(this)
                                .transition()
                                .attr("r", radius - 6);


                        d3.select("#tooltip")
                            .html("")
                            .style("left", 0)
                            .style("top", 0)
                            .style("opacity", 0);

                    });

                h1_node
                    .append("text")
                    .style("font-size", function (d) {
                        if (d3.select("#fileversion3radio")._groups[0][0].checked == true)
                            return "20px";
                        else
                            return "40px";
                        //console.log(data_nodes[0]);
                        //return data_nodes[0].height - 1.5 + "em";
                    })
                    .attr("class", function (d) {
                        return "text " + d.data.data.child
                            .replaceAll(/\//g, "")
                            .replaceAll(".", "")
                            .replaceAll(" ", "")
                            .replaceAll("(", "")
                            .replaceAll(")", "")
                            .toLowerCase();
                    })

                    .attr("dy", "2em")
                    .attr("x", function (d) {

                        if ((this.previousSibling).getAttribute("class").includes("leaf"))
                            return d.x - 8;
                        else
                            return d.x + 20;
                    })
                    .attr("y", function (d) {
                        if ((this.previousSibling).getAttribute("class").includes("leaf"))
                            return d.y - 20;
                        else
                            return d.y - 70;
                    })
                    .attr("text-anchor", function (d) {
                        return "start";
                    })

                    .style("opacity", function (d) {
                        /*  if (d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion2radio")._groups[0][0].checked == true) {
                             if (d.depth <= 1)
                                 return 1;
                             else
                             return 0;
                         }
                         //  console.log(d);
 
                         else return 1; */
                        if (d3.select("#fileversion2radio")._groups[0][0].checked == true || d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion6radio")._groups[0][0].checked == true)
                            return 0;
                        else
                            return 1;
                    })
                    .text(function (d) {
                        // console.log(d);
                        var label = d.data.data.child;
                        if (label.includes("_"))
                            label = label.substring(label.indexOf("_") + 1, label.length);
                        if (label.includes("/"))
                            label = label.substring(label.lastIndexOf("/") + 1, label.length);
                        return label;
                    });
            }


            /* END OF H1 TREE*/



            /* START OF H2 TREE */

            function h2tree(h2_root) {

                console.log(h2_root.children);

                d3.select("#h2tree").remove();

                var h2tree = d3
                    .tree()
                    //.nodeSize([]);
                    .size([1450, 500]);


                var h2_tree = h2tree(h2_root);




                var h2_node = mergedtree_svg
                    .append("g")
                    .attr("id", "h2tree")
                    .attr("transform", "translate(" + 50 + "," + 100 + ")")
                    .selectAll(".h2_node")
                    .data(h2_tree.descendants())
                    .enter()
                    .append("g")
                    .attr("class", function (d) {
                        //   console.log(d);
                        return d.child;
                    });

                mergedtree_svg.select("#h2tree")
                    .append("rect")
                    .attr('x', -30)
                    .attr('y', -30)
                    .attr('width', 1500)
                    .attr('height', 600)
                    .attr('stroke', 'black')
                    .attr('fill', 'none');


                /*  var len = h2_node._groups[0].length;
     
                 console.log(h2_node);
     
                 var h2_node_sliced = h2_node._groups[0].slice(1, len);
     
                 console.log(h2_node_sliced); */

                var h2_link = h2_node
                    .append("path")
                    .data(h2_tree.links())
                    // .enter()
                    .attr("class", function (d) {
                        return "h2_link";
                    })
                    //.classed("link", true)
                    .attr("d", function (d) {
                        return "M" + d.source.x + "," + d.source.y
                            + "C" + d.source.x + "," + (d.source.y + d.target.y) / 2
                            + " " + d.target.x + "," + (d.source.y + d.target.y) / 2
                            + " " + d.target.x + "," + (d.target.y);
                    })
                    .style("opacity", function (d) {
                        return 0.3;
                    })
                    //.style("stroke", "#ccc")
                    .style("stroke", "red")
                    .style("fill", "none")
                    .style("stroke-width", "5px");

                h2_node
                    .append("circle")
                    .attr("cx", function (d) {
                        // console.log(d);
                        // console.log(radialPoint(d.x, d.y));
                        return d.x;
                    })
                    .attr("cy", function (d) {
                        return d.y;
                    })
                    .attr("r", function (d) {
                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                            return radius + "px";
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                            return (radius - 4) + "px";
                    })
                    .attr("class", function (d) {
                        return (
                            "node" + (d.children ? " node--internal" : " node--leaf")
                        );
                    })
                    .attr("id", function (d) {
                        return "h2tree_" + d.data.data.child
                            .replaceAll(/\//g, "")
                            .replaceAll(".", "")
                            .replaceAll(" ", "")
                            .replaceAll("(", "")
                            .replaceAll(")", "")
                            .toLowerCase();
                    })
                    .style("fill", function (d) {
                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                            return h1color;
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                            return "white";
                    })
                    .style("stroke", function (d) {
                        //console.log(h1color);
                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                            return "none";
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                            return h1color;

                    })
                    .style("stroke-width", function (d) {
                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                            return "0px";
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                            return "5px";

                    })

                    .style("opacity", function (d) {
                        return 0.3;
                    })
                    .on("mouseover", function (d, i) {
                        var name = d.data.data.child;
                        //console.log(name);
                        //if (name == undefined)
                        //name = d.data.data.child;
                        var text = "Element: <b>" + name + "</b><br>Element code: <b>" + d.data.data.child + "</b><br>Parent code: <b>" + d.data.data.parent + "</b>";
                        d3.select("#tooltip")
                            .html(text)

                            .style("left", parseInt(d3.event.pageX - 200) + "px")
                            .style("top", parseInt(d3.event.pageY + 50) + "px")
                            .style("text-align", "left")
                            .style("opacity", 1);

                        d3.select(this)
                            .transition()
                            .attr("r", 15);
                    })
                    .on("mouseleave", function (d) {

                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                            d3.select(this)
                                .transition()
                                .attr("r", radius - 3);
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                            d3.select(this)
                                .transition()
                                .attr("r", radius - 6);


                        d3.select("#tooltip")
                            .html("")
                            .style("left", 0)
                            .style("top", 0)
                            .style("opacity", 0);

                    });



                h2_node
                    .append("text")
                    .style("font-size", function (d) {
                        if (d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion2radio")._groups[0][0].checked == true)
                            return "20px";
                        else
                            return "40px";
                        //  return (h2_tree.descendants()[0].height + 2) - (d.depth) + "em";
                    })
                    .attr("class", function (d) {
                        return "text " + d.data.data.child
                            .replaceAll(/\//g, "")
                            .replaceAll(".", "")
                            .replaceAll(" ", "")
                            .replaceAll("(", "")
                            .replaceAll(")", "")
                            .toLowerCase();
                    })
                    //.classed("text", true)
                    .attr("dy", "2em")
                    .attr("x", function (d) {

                        //console.log(d3.select(this.parentNode)._groups[0][0].children[1].getAttribute("class"));
                        if (d3.select(this.parentNode)._groups[0][0].children[1].getAttribute("class").includes("leaf"))
                            return d.x - 8;
                        else
                            return d.x + 20;
                    })
                    .attr("y", function (d) {
                        //if ((this.previousSibling).getAttribute("class").includes("leaf"))
                        if (d3.select(this.parentNode)._groups[0][0].children[1].getAttribute("class").includes("leaf"))
                            return d.y - 20;
                        else
                            return d.y - 30;
                    })
                    .attr("text-anchor", function (d) {
                        return "start";
                    })

                    .style("opacity", function (d) {
                        /*  if (d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion2radio")._groups[0][0].checked == true) {
                             if (d.depth <= 1)
                                 return 1;
                             else
                             return 0;
                         }
                         //  console.log(d);
 
                         else return 1; */
                        if (d3.select("#fileversion2radio")._groups[0][0].checked == true || d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion6radio")._groups[0][0].checked == true)
                            return 0;
                        else
                            return 1;
                    })
                    .text(function (d) {
                        // console.log(d);
                        var label = d.data.data.child;
                        if (label.includes("_"))
                            label = label.substring(label.indexOf("_") + 1, label.length);
                        if (label.includes("/"))
                            label = label.substring(label.lastIndexOf("/") + 1, label.length);
                        return label;
                    });
            }


            /* END OF H2 TREE*/





            /* START OF MERGED TREE */

            function collapse(d) {
                if (d.children) {
                    d._children = d.children
                    d._children.forEach(collapse)
                    d.children = null
                }
            }


            function mergedtree(source) {



                //console.log(hier_root);
                var tree = d3
                    .tree()
                    //.nodeSize([50]);
                    .size([width, height]);

                //console.log(hier_root);

                mtree = tree(hier_root);

                //console.log(mtree.descendants()[0]);







                //console.log("MERGED TREE");

                nodes = mtree.descendants();
                links = mtree.links();


                console.log(nodes);
                //console.log(source);


                //remove this for temp fix


                //d3.select("#mergedtree").selectAll("g").remove();

                /* var nodes_data = nodes.filter(function (el) {
                    if (el.position == "expand") {
                        return el;
                    }
                });

                


                var links_data = links.filter(function (el) {
                    if (el.target.position == "expand") {
                        return el;
                    }
                }); */

                var duration = 500;
                //nodes = source;
                //nodes_data = nodes;

                //console.log(nodes_data);
                //for (var i = 0; i < nodes_data.length; i++)
                //console.log(nodes_data[i].data.data.child + " " + nodes_data[i].position + " " + nodes_data[i].childrenposition);

                var color = "orange";
                var triangleSize = 2100;
                var verticalTransform = 1000 + Math.sqrt(triangleSize);

                var triangle_shape = d3.symbol()
                    .type(d3.symbolTriangle)
                    .size(triangleSize);



                var node = mergedtree_svg
                    .select("#mergedtree")
                    .selectAll(".nodes")
                    .data(nodes, function (d, i) {
                        //return d.data.data.child;

                        //return d.id || (d.id = ++i);
                        //return ++i;
                        return d.id;
                    });

                var triangle = mergedtree_svg
                    .select("#mergedtree")
                    //.selectAll(".nodes")
                    .selectAll(".triangle")
                    .data(nodes, function (d, i) {
                        return "tri" + d.data.data.child;

                        //return d.id || (d.id = ++i);
                        //return ++i;
                        //return d.id;
                    });



                /*
            // Define the zoom function for the zoomable tree

            function zoom() {
                svgGroup.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
            }


            // define the zoomListener which calls the zoom function on the "zoom" event constrained within the scaleExtents
            var zoomListener = d3.zoom().scaleExtent([0.1, 3]).on("zoom", zoom);
*/

                //console.log(node);

                /*  var triEnter = triangle
                     //.data(mergedtree.descendants())
                     //.selectAll(".triangle")
                     .enter()
                     .append("path")
                     .attr("class", function (d) {
                         "triangle " + d.data.data.child;
                     })
                     .attr("d", triangle_shape)
                     .attr("stroke", color)
                     .style("stroke-width", "13px")
                     .attr("fill", "white")
                     .attr("transform", function (d, i) {
 
                         var y = (source.data.data.level === 0 ? 50 : source.data.data.level * 300);
                         return "translate(" + source.x + "," + y + ")";
                     }); */

                var nodeEnter = node
                    //.data(mergedtree.descendants())
                    .enter()
                    .append("g")
                    .attr("class", "nodes")
                    .attr("transform", function (d, i) {
                        //console.log("ENTER " + d.data.data.child);
                        //console.log(source);
                        //console.log(source.y);
                        var y = (source.data.data.level === 0 ? 50 : source.data.data.level * 300);
                        return "translate(" + source.x + "," + y + ")";
                    })
                    .on("click", function (d) {
                        click(d);
                    });


                var triUpdate = nodeEnter
                    .merge(triangle)
                    .transition()
                    //.duration(duration)
                    .attr("transform", function (d) {
                        //console.log("UPDATE");
                        //console.log(d);

                        //console.log(source.data.data.child);
                        var y = (d.data.data.level === 0 ? 50 : d.data.data.level * 300);
                        //y = y + 20;
                        //if (source.data.data.child == "root")
                        //console.log(d.data.data.child);
                        //console.log(d.x + " " + y);
                        return "translate(" + d.x + "," + y + ")";
                        //else
                        // return "translate(" + source.x + "," + y + ")";
                    });



                var nodeUpdate = nodeEnter
                    .merge(node)
                    .transition()
                    //.duration(duration)
                    .attr("transform", function (d) {
                        //console.log("UPDATE");
                        //console.log(d);
                        //console.log(source.data.data.child);
                        var y = (d.data.data.level === 0 ? 50 : d.data.data.level * 300);
                        //if (source.data.data.child == "root")
                        return "translate(" + d.x + "," + y + ")";
                        //else
                        // return "translate(" + source.x + "," + y + ")";
                    });



                nodeUpdate
                    .selectAll("text")
                    .style("fill-opacity", 1);

                var triExit = node
                    //.selectAll("circle")
                    .exit()
                    .transition()
                    .duration(duration)
                    .attr("size", function (d) {
                        //console.log("EXIT ");

                        return 0;
                    })
                    .attr("transform", function (d) {
                        //console.log(d);
                        //var y = (d.parent.data.data.level === 0 ? 50 : d.parent.data.data.level * 300);
                        //return "translate(" + d.parent.x + "," + y + ")";

                        var y = (source.data.data.level === 0 ? 50 : source.data.data.level * 300);
                        return "translate(" + source.x + "," + y + ")";
                    })
                    .remove();


                var nodeExit = node
                    //.selectAll("circle")
                    .exit()
                    .transition()
                    .duration(duration)
                    .attr("r", function (d) {
                        //console.log("EXIT ");

                        return 0;
                    })
                    .attr("transform", function (d) {
                        //console.log(d);
                        //var y = (d.parent.data.data.level === 0 ? 50 : d.parent.data.data.level * 300);
                        //return "translate(" + d.parent.x + "," + y + ")";

                        var y = (source.data.data.level === 0 ? 50 : source.data.data.level * 300);
                        return "translate(" + source.x + "," + y + ")";
                    })
                    .remove();



                nodeExit.select("text")
                    .style("fill-opacity", 0);











                var index = nodes.length;
                //console.log(nodes);
                //console.log(nodes[index - 1]);
                var levels = new Array(nodes[index - 1].depth + 1).fill(0);
                //console.log(levels);



                //for (var i = 0; i < mergedtree.descendants())
                //console.log(mergedtree.links()); 






                /* mergedtree_svg
                    .selectAll(".nodes")
                    .on("click", click); */







                /*
                                function click(d, nodes, links) {
                                    //console.log("CLICK");
                                    //console.log(e);
                                    //console.log(d.data.data.child + " " + d.position);
                                    //console.log(d.descendants());
                                    var descendants = [];
                
                                    if (d.childrenposition == "expand")
                                        d.childrenposition = "collapse";
                                    else
                                        d.childrenposition = "expand";
                
                
                                    d.descendants().forEach(function (des, i) {
                                        console.log(des.data.data.child + " " + i);
                                        if (des.parent)
                                            if (des.parent.childrenposition == "expand")
                                                des.position = "expand";
                                            else {
                                                des.position = "collapse";
                                                des.childrenposition = "collapse";
                                            }
                
                
                                    });
                
                                    descendants.splice(0, 1);
                
                                    //console.log(descendants);
                
                
                                   
                                    //remove for collapse
                                    mergedtree(nodes, links, d);
                
                                    //console.log(nodes);
                                }
                                */


                function click(d) {
                    if (d.children) {
                        d._children = d.children;
                        d.children = null;
                    } else {
                        d.children = d._children;
                        d._children = null;
                    }
                    console.log(d);
                    if (d.children != null || d._children != null)
                        mergedtree(d);

                }




                nodeEnter
                    .append("path")
                    .attr("class", "triangle")
                    .attr("d", triangle_shape)
                    .attr("stroke", function (d) {
                        if (!d._children && !d.children)
                            return color;
                        else return "green";
                    })
                    .style("stroke-width", "13px")
                    .attr("fill", "white")
                    .attr("transform", function (d) {
                        //var y = (d.data.data.level === 0 ? 50 : d.data.data.level * 300);
                        //y = y + 2;

                        //var trans = "translate(" + d.x + "," + y + ")";


                        if (d._children)
                            return "rotate(180)";
                        else
                            return "";
                    });
                   /*  .attr("transform", function (d, i) {

                        var y = (d.data.data.level === 0 ? 50 : d.data.data.level * 300);
                        return "translate(" + d.x + "," + y + ")";
                    }) */;





                //console.log("SOLID");
                nodeEnter
                    .append("circle")
                    /*
                    .attr("cx", function (d, i) {
                        //console.log(i);
                        //console.log(source);
                        // console.log(d);
                        // console.log(radialPoint(d.x, d.y));
                        return d.x;
                    })
                    .attr("cy", function (d, i) {
                        //var y = source[i].y;
 
                        //console.log(source[i]);
 
                        
                        var y = (d.data.data.level === 0 ? 50 : d.data.data.level * 300);
                        return y;
 
                        //return d.data.data.y;
 
                    })
                    */
                    .attr("r", function (d) {
                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true)
                            return radius + "px";
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                            return (radius - 3) + "px";
                    })
                    .attr("class", function (d) {
                        return (
                            "node" + (d.children ? " node--internal" : " node--leaf")
                        );
                    })
                    .attr("id", function (d) {
                        return "mergedtree_" + d.data.data.child
                            .replaceAll(/\//g, "")
                            .replaceAll(".", "")
                            .replaceAll(" ", "")
                            .replaceAll("(", "")
                            .replaceAll(")", "")
                            .toLowerCase();
                    })
                    .style("fill", function (d) {
                        //            console.log(d.data.data.shape);
                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true) {
                            //console.log("solid");
                            return d.data.data.color;
                        }


                        else if (d3.select("#hollowshaperadio")._groups[0][0].checked == true) {
                            //console.log("hollow");
                            if (d.data.data.shape == "h1")
                                return "white";
                            else
                                return h1color;
                        }



                    })
                    // .style("opacity", 1)

                    .style("stroke-dasharray", function (d) {
                        /*  if (d.data.data.bordertype == "solid")
                             return "none";
                         else
 
                             return "8,8.5"; */
                        return "solid";

                    })

                    .style("opacity", function (d) {
                        return 1;
                    })
                    .on("mouseover", function (d) {
                        var circle_id = this.getAttribute("id");
                        circle_id = circle_id.split("_")[1];

                        //console.log(circle_id);

                        var name = d.data.data.child;
                        //console.log(name);
                        //if (name == undefined)
                        //  name = d.data.data.child;
                        var text = "Element: <b>" + name + "</b><br>Parent code: <b>" + d.data.data.parent + "</b>"
                            + "<br>Description: <b>" + d.data.data.description + "</b>";
                        d3.select("#tooltip")
                            .html(text)
                            .style("left", parseInt(d3.event.pageX + 100) + "px")
                            .style("top", parseInt(d3.event.pageY) + "px")
                            .style("text-align", "left")
                            .style("opacity", 1);



                        d3.select(this)
                            .transition()
                            .attr("r", radius + 5);


                        d3.select("#h1tree")
                            .select("#h1tree_" + circle_id)
                            .style("opacity", 1);

                        d3.select("#h2tree")
                            .select("#h2tree_" + circle_id)
                            .style("opacity", 1);


                        if (d3.select("#fileversion2radio")._groups[0][0].checked == true || d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion6radio")._groups[0][0].checked == true) {
                            d3.select("#h1tree")
                                .selectAll(".text")
                                .select("." + circle_id)
                                .style("opacity", 1);

                            d3.select("#h2tree")
                                .selectAll(".text")
                                .select("." + circle_id)
                                .style("opacity", 1);
                        }


                        // console.log(h1_root.descendants());

                        for (var i = 1; i < h1_root.descendants().length; i++) {
                            var name = h1_root.descendants()[i].data.data.child
                                .replaceAll(/\//g, "")
                                .replaceAll(".", "")
                                .replaceAll(" ", "")
                                .replaceAll("(", "")
                                .replaceAll(")", "")
                                .toLowerCase();
                            if (name == circle_id) {
                                var children = (h1_root.descendants()[0]).path(h1_root.descendants()[i]);
                                // console.log(children);

                                var node_id;
                                for (var j = 0; j < children.length; j++) {
                                    // console.log(children[j]);

                                    node_id = children[j].data.id
                                        .replaceAll(/\//g, "")
                                        .replaceAll(".", "")
                                        .replaceAll(" ", "")
                                        .replaceAll("(", "")
                                        .replaceAll(")", "")
                                        .toLowerCase();
                                    //console.log(node_id);
                                    //console.log(children[j]);
                                    d3.select("#h1tree").select("#h1tree_" + node_id).style("opacity", "1");
                                    d3.select("#h1tree").selectAll(".text" + "." + node_id).style("opacity", "1");
                                }

                            }
                        }


                        for (var i = 1; i < h2_root.descendants().length; i++) {
                            var name = h2_root.descendants()[i].data.data.child
                                .replaceAll(/\//g, "")
                                .replaceAll(".", "")
                                .replaceAll(" ", "")
                                .replaceAll("(", "")
                                .replaceAll(")", "")
                                .toLowerCase();
                            if (name == circle_id) {
                                var children = (h2_root.descendants()[0]).path(h2_root.descendants()[i]);
                                // console.log(children);

                                var node_id;
                                for (var j = 0; j < children.length; j++) {
                                    // console.log(children[j]);
                                    node_id = children[j].data.id
                                        .replaceAll(/\//g, "")
                                        .replaceAll(".", "")
                                        .replaceAll(" ", "")
                                        .replaceAll("(", "")
                                        .replaceAll(")", "")
                                        .toLowerCase();

                                    //console.log(node_id);
                                    //console.log(children[j]);
                                    d3.select("#h2tree").select("#h2tree_" + node_id).style("opacity", "1");
                                    d3.select("#h2tree").selectAll(".text" + "." + node_id).style("opacity", "1");
                                }

                            }
                        }



                    })
                    .on("mouseleave", function (d) {


                        d3.select("#tooltip")
                            .html("")
                            .style("left", "0px")
                            .style("top", "0px")
                            .style("opacity", 0);


                        var circle_id = this.getAttribute("id");
                        circle_id = circle_id.split("_")[1];



                        if (d3.select("#solidshaperadio")._groups[0][0].checked == true) {
                            d3.select(this)
                                .transition()
                                .attr("r", radius);
                        }
                        if (d3.select("#hollowshaperadio")._groups[0][0].checked == true) {
                            d3.select(this)
                                .transition()
                                .attr("r", radius - 4);
                        }




                        /* d3.select("#h1tree")
                            .select("#h1tree_" + circle_id)
                            .transition()
                            .style("opacity", 0.3);

                        d3.select("#h2tree")
                            .select("#h2tree_" + circle_id)
                            .style("opacity", 0.3); */

                        d3.select("#h1tree")
                            .selectAll(".node")
                            .style("opacity", 0.3);

                        d3.select("#h2tree")
                            .selectAll(".node")
                            .style("opacity", 0.3);

                        //console.log(d3.select("#fileversion2radio")._groups[0][0].checked);
                        //console.log(d3.select("#fileversion3radio")._groups[0][0].checked);
                        //console.log(d3.select("#fileversion6radio")._groups[0][0].checked);

                        if (d3.select("#fileversion2radio")._groups[0][0].checked == true || d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion6radio")._groups[0][0].checked == true) {
                            d3.select("#h1tree")
                                .selectAll(".text")
                                .style("opacity", 0);

                            d3.select("#h2tree")
                                .selectAll(".text")
                                .style("opacity", 0);

                        }
                        else {
                            d3.select("#h1tree")
                                .selectAll(".text")
                                .style("opacity", 1);

                            d3.select("#h2tree")
                                .selectAll(".text")
                                .style("opacity", 1);

                        }

                        /*
                                                for (var i = 1; i < h1_root.descendants().length; i++) {
                                                    if (h1_root.descendants()[i].data.data.child == circle_id) {
                                                        var children = (h1_root.descendants()[0]).path(h1_root.descendants()[i]);
                                                        // console.log(children);
                        
                                                        var node_id;
                                                        for (var j = 0; j < children.length; j++) {
                                                            // console.log(children[j]);
                                                            node_id = children[j].data.id;
                                                            console.log(node_id);
                                                            //console.log(children[j]);
                                                            d3.select("#h1tree").select("#h1tree_" + node_id).style("opacity", "0.3");
                                                            d3.select("#h1tree").select(".text_" + node_id).style("opacity", "0.3");
                        
                                                        }
                        
                                                    }
                                                }
                        
                        
                                                for (var i = 1; i < h2_root.descendants().length; i++) {
                                                    if (h2_root.descendants()[i].data.data.child == circle_id) {
                                                        var children = (h2_root.descendants()[0]).path(h2_root.descendants()[i]);
                                                        // console.log(children);
                        
                                                        var node_id;
                                                        for (var j = 0; j < children.length; j++) {
                                                            // console.log(children[j]);
                                                            node_id = children[j].data.id;
                                                            // console.log(node_id);
                                                            //console.log(children[j]);
                                                            d3.select("#h2tree").select("#h2tree_" + node_id).style("opacity", "0.3");
                                                            d3.select("#h2tree").select(".text_" + node_id).style("opacity", "0.3");
                                                        }
                        
                                                    }
                                                }
                        
                                                */

                    });
                // console.log(mergedtree.links());




                if (d3.select("#hollowshaperadio")._groups[0][0].checked == true) {
                    //console.log("HOLLOW");
                    nodeEnter
                        .append("circle")
                        /*
                        .attr("cx", function (d, i) {
                            // console.log(d);
                            // console.log(radialPoint(d.x, d.y));
                            //return source[i].x;
 
 
                            return d.x;
 
                        })
                        .attr("cy", function (d, i) {
                            //console.log(d);
 
                            // var y = source[i].y;
 
 
                            
                            var y = (d.data.data.level === 0 ? 50 : d.data.data.level * 300);
 
                            return y;
 
 
                            //levels[d.depth] = d.data.data.y;
                            //return d.data.data.y;
                        })
                        */
                        .attr("r", function (d) {

                            if (d3.select("#hollowshaperadio")._groups[0][0].checked == true)
                                return (radius + 5) + "px";
                        })
                        .attr("class", function (d) {
                            return (
                                "node" + (d.children ? " node--internal" : " node--leaf")
                            );
                        })
                        .attr("id", function (d) {
                            return "mergedtree_" + d.data.data.child
                                .replaceAll(/\//g, "")
                                .replaceAll(".", "")
                                .replaceAll(" ", "")
                                .replaceAll("(", "")
                                .replaceAll(")", "")
                                .toLowerCase();
                        })
                        .style("fill", function (d) {
                            return "none";
                        })
                        .style("stroke", function (d) {
                            //if (d.data.data.shape == "h1" || d.data.data.shape == "merged")
                            //  return h1color;
                            //console.log(d);
                            if (d.data.data.shape == "h1" || d.data.data.shape == "merged")
                                return d.data.data.levelcolor;

                            else return "none";
                        })
                        .style("stroke-width", "8px")
                        .style("stroke-dasharray", function (d) {
                            /*  if (d.data.data.bordertype == "solid")
                                 return "none";
                             else
                                 return "8,8.5"; */
                            //return "10,10";
                            return "solid";

                        })
                        .style("opacity", function (d) {
                            return 1;
                        })
                        .on("mouseover", function (d, i) {



                            var name = d.data.data.child;
                            //console.log(name);
                            //if (name == undefined)
                            //name = d.data.data.child;
                            var text = "Element: <b>" + name + "</b><br>Element code: <b>" + d.data.data.child + "</b><br>Parent code: <b>" + d.data.data.parent + "</b>";
                            d3.select("#tooltip")
                                .html(text)
                                .style("left", parseInt(d3.event.pageX + 100) + "px")
                                .style("top", parseInt(d3.event.pageY) + "px")
                                .style("text-align", "left")
                                .style("opacity", 1);

                            d3.select(this)
                                .transition()
                                .attr("r", 20);
                        })
                        .on("mouseleave", function (d) {
                            d3.select(this)
                                .transition()
                                .attr("r", radius + 5);

                            d3.select("#tooltip")
                                .html("")
                                .style("left", 0)
                                .style("top", 0)
                                .style("opacity", 0);

                        });
                    /* .on("click", function (d) {
                        //console.log("click");
                        //console.log(e);
                        console.log(d);
                        click(d, nodes, links);
                    }); */



                }






                nodeEnter
                    .append("text")
                    .style("font-size", function (d) {
                        if (d3.select("#fileversion2radio")._groups[0][0].checked == true || d3.select("#fileversion3radio")._groups[0][0].checked == true || d3.select("#fileversion6radio")._groups[0][0].checked == true) {
                            if ((this.previousSibling).getAttribute("class").includes("leaf"))
                                return "20px";
                            else return "50px";
                        }

                        else
                            return "40px";
                    })
                    .attr("class", function (d) {
                        return d.data.data.child
                            .replaceAll(" ", "")
                            .replaceAll("(", "")
                            .replaceAll(")", "")
                            .toLowerCase();
                    })
                    .classed("text", true)
                    // .style("font-size", "20px")
                    .attr("dx", "0em")
                    .attr("dy", "2em")
                    .attr("text-anchor", function (d) {
                        return "start";
                    })

                    .style("opacity", function (d) {
                        /*   if (d3.select("#fileversion3radio")._groups[0][0].checked == true) {
                              if (d.depth <= 2)
                                  return 1;
                              else
                                  return 0;
                          }
                          else return 1; */
                        return 1;
                    })
                    /* .attr("transform", function (d) {
                        return "rotate(90)";
                    }) */
                    .text(function (d) {
                        // console.log(d);
                        var label = d.data.data.child;
                        if (label.includes("_"))
                            label = label.substring(label.indexOf("_") + 1, label.length);
                        if (label.includes("/"))
                            label = label.substring(label.lastIndexOf("/") + 1, label.length);
                        return label;
                    });


                //console.log(links);
                //console.log(links_data);




                //normal links
                var link = mergedtree_svg
                    .select("#mergedtree")
                    //.append("g")
                    //.attr("id", "links")
                    .selectAll(".link")
                    .data(links, function (d) {
                        //console.log(d.target.id);
                        return d.target.id;
                    });

                //console.log(link);

                var linkEnter = link
                    .enter()
                    .append("path")
                    .attr("class", function (d) {
                        //console.log(d);
                        if (d.target.data.data.linkcolor == "blue")
                            return "link " + "merged";
                        else if (d.target.data.data.linkcolor == "green")
                            return "link " + "h2parent";
                        else
                            return "link " + "h1parent";
                        //return "link";

                    })
                    // .insert("path", "g")

                    .attr("d", function (d) {

                        var sourcex = source.x, targetx = source.x

                        //console.log(d.source.data.data.child);

                        // if (d3.select("#leavesdiffheightradio")._groups[0][0].checked == true) {
                        //check y pos/
                        var sourcey = source.data.data.level === 0 ? 50 : source.data.data.level * 300;
                        var targety = source.data.data.level === 0 ? 50 : source.data.data.level * 300;
                        //}



                        return "M" + sourcex + "," + parseInt(sourcey + 10)
                            + "C" + sourcex + "," + (sourcey + 10 + targety) / 2
                            + " " + targetx + "," + (sourcey + targety) / 2
                            + " " + targetx + "," + (targety + 10);
                    })
                    .style("opacity", function (d) {
                        /* if (d.parent != "" && d.h1parent == "" && d.h2parent == "")
                            return 0.1;
                        else if (d.h1parent != "" && d.h2parent == "")
                            return 0.7;
                        else if (d.h1parent == "" && d.h2parent != "")
                            return 0.7; */

                        if (d.target.data.data.linkcolor == "blue")
                            return 0.3;
                        else
                            return 0.7;
                    })
                    //.style("stroke", "#ccc")
                    .style("stroke", function (d) {
                        //if (d.source.data.data.shape == "h1" || (d.source.data.data.shape == "h2" && d.source.data.data.linkcolor != "red" && d.target.data.data.linkcolor != "red"))
                        //  return "green";
                        //else
                        return d.target.data.data.linkcolor;
                    })
                    .style("fill", "none")
                    .style("stroke-width", "7px");


                linkEnter
                    .merge(link)
                    .transition()
                    //.duration(duration)
                    .attr("d", function (d) {
                        //console.log("update");
                        //console.log(d.source.data.data.child);
                        var sourcex = d.source.x, targetx = d.target.x;
                        var sourcey = d.source.data.data.level === 0 ? 50 : d.source.data.data.level * 300;
                        var targety = d.target.data.data.level === 0 ? 50 : d.target.data.data.level * 300;

                        targety = targety - 25;

                        return "M" + sourcex + "," + parseInt(sourcey + 10)
                            + "C" + sourcex + "," + (sourcey + 10 + targety) / 2
                            + " " + targetx + "," + (sourcey + targety) / 2
                            + " " + targetx + "," + (targety + 10);
                    });

                // Transition exiting nodes to the parent's new position.
                link
                    .exit()
                    .transition()
                    .duration(duration)
                    .attr("d", function (d) {
                        //console.log("exit");
                        var sourcex = source.x, targetx = source.x;
                        var sourcey = source.data.data.level === 0 ? 50 : source.data.data.level * 300;
                        var targety = source.data.data.level === 0 ? 50 : source.data.data.level * 300;
                        return "M" + sourcex + "," + parseInt(sourcey + 10)
                            + "C" + sourcex + "," + (sourcey + 10 + targety) / 2
                            + " " + targetx + "," + (sourcey + targety) / 2
                            + " " + targetx + "," + (targety + 10);
                    })
                    .remove();


                function hidelinks() {
                    console.log("hide links");

                    d3.selectAll(".merged").style("opacity", 0.3);
                    d3.selectAll(".h1parent").style("opacity", 0.7);
                    d3.selectAll(".altlink").remove();
                }

                function showlinks() {

                    console.log("show links");

                    //alternate parent links
                    links
                        .forEach(function (d, i) {


                            d3.selectAll(".h1parent").style("opacity", 0);

                            var altparent = d.target.data.data.alternateparent.replaceAll(/\//g, "").replaceAll(".", "");
                            var child = d.target.data.data.child.replaceAll(/\//g, "").replaceAll(".", "");
                            var h2parent = d.target.data.data.h2parent.replaceAll(/\//g, "").replaceAll(".", "");

                            console.log("c:" + child + " ap:" + altparent + " h1:" + d.target.data.data.h1parent + " h2:" + h2parent);

                            if (altparent != "") {

                                //console.log("c:" + child + " ap:" + altparent + " h1:" + d.target.data.data.h1parent + " h2:" + h2parent);

                                var sourcex = "";
                                var sourcey = "";

                                for (var j = 0; j < nodes.length; j++) {
                                    if (nodes[j].data.data.child == altparent) {
                                        sourcex = nodes[j].x;
                                        sourcey = nodes[j].data.data.level === 0 ? 50 : nodes[j].data.data.level * 300;
                                    }
                                }

                                var targetx = d3.select("#mergedtree").select("#mergedtree_" + child.toLowerCase())._groups[0][0].__data__.x;
                                var targety = d.target.data.data.level === 0 ? 50 : d.target.data.data.level * 300;

                                d3.select("#mergedtree").append("path")
                                    .attr("class", function (d) {
                                        return "altlink";
                                    })
                                    .classed(altparent + "-" + child, true)
                                    .attr("d", function (d) {

                                        if (targety == sourcey) {
                                            console.log("SAME LEVEL");
                                            if (sourcex < targetx)
                                                return "M" + sourcex + "," + (sourcey + radius)
                                                    + "L" + sourcex + "," + (sourcey + radius + 50)
                                                    + "L" + (targetx - radius - 20) + "," + (targety + radius + 50)
                                                    + "L" + (targetx - radius - 20) + "," + (targety - radius - 50)
                                                    + "L" + (targetx) + "," + (targety - radius - 50)
                                                    + "L" + (targetx) + "," + (targety + radius);

                                            else
                                                return "M" + sourcex + "," + (sourcey + radius)
                                                    + "L" + sourcex + "," + (sourcey + radius + 50)
                                                    + "L" + (targetx - radius - 20) + "," + (targety + radius + 50)
                                                    + "L" + (targetx - radius - 20) + "," + (targety - radius - 50)
                                                    + "L" + (targetx) + "," + (targety - radius - 50)
                                                    + "L" + (targetx) + "," + (targety + radius);

                                        }

                                        if (targety < sourcey) {
                                            //console.log("RECURSIVE PARENT");
                                            return "M" + targetx + "," + (targety - radius)
                                                + "L" + targetx + "," + (targety - 50)
                                                + "L" + (targetx + 50) + "," + (targety - 50)
                                                + "L " + (sourcex + 50) + "," + (sourcey + 50)
                                                + "L" + (sourcex) + "," + (sourcey + 50)
                                                + "L" + sourcex + "," + (sourcey + radius);
                                        }

                                        else {
                                            //console.log("NORMAL LEVEL");
                                            return "M" + sourcex + "," + sourcey
                                                + "C" + sourcex + "," + (sourcey + targety) / 2
                                                + " " + targetx + "," + (sourcey + targety) / 2
                                                + " " + targetx + "," + targety;
                                        }

                                    })
                                    .style("opacity", function (d) {
                                        return 1;
                                    })
                                    .style("stroke", "green")
                                    .style("stroke-dasharray", "3,3")
                                    //.style("stroke-dasharray", "3,3")
                                    .style("fill", "none")
                                    .style("stroke-width", "7px");

                            }

                        });
                }



                nodes.forEach(function (d) {
                    d.x0 = d.x;
                    d.y0 = d.y;
                });


                for (var n = 0; n < nodes.length; n++) {
                    levels[nodes[n].depth] = nodes[n].depth === 0 ? 50 : nodes[n].depth * 300;
                }

                //console.log(nodes[0].height);
                /* var accent = d3
                    .scaleSequential()
                    .domain([0, nodes[0].height])
                    .interpolator(d3.interpolateInferno); */

                var accent = d3
                    // .range(0, nodes[0].height)
                    .scaleOrdinal(d3.schemeCategory10);



                if (d3.select("#levellines").empty()) {

                    var n = 0;

                    var levelg = mergedtree_svg
                        .append("g")
                        .attr("id", "levellines")
                        .attr("transform",
                            "translate(" + (margin.left + 40) + "," + (margin.top + 800) + ")");

                    d3
                        .select("#levellines")
                        .selectAll("line")
                        .data(levels)
                        .enter()
                        .append("line")
                        .attr("x1", function (d) {
                            //console.log(d);
                            return 100;

                        })
                        .attr("y1", function (d) {
                            return d + 10;
                        })
                        .attr("x2", function (d) {

                            return width;
                        })
                        .attr("y2", function (d) {

                            return d + 10;


                        })
                        .style("stroke", "grey")
                        .style("stroke-width", 12)
                        .style("stroke-dasharray", "6,60")
                        .style("opacity", 0.6);



                    levelg
                        .selectAll("text")
                        .data(levels)
                        .enter()
                        .append("text")
                        .attr("class", function (d, i) {
                            return "text-level" + i;
                        })
                        .style("font-size", "40px")
                        .attr("dy", "2em")
                        .attr("x", function (d) {
                            //return -150;
                            return width + 20;

                        })
                        .attr("y", function (d) {
                            return d - 75;
                        })
                        .attr("text-anchor", function (d) {
                            return "start";
                        })
                        .attr("fill", function (d, i) {
                            return accent(i);
                        })
                        .text(function (d, i) {
                            return "Level: " + i;
                        })
                        .on("mouseover", function (d) {
                            d3.select(this).style("cursor", "pointer");
                        })
                        .on("click", function (d) {
                            var levelline = d3.select(this).text().split(": ")[1];
                            //alert(document.getElementById("line-chart-l" + levelline).style.opacity);
                            if (document.getElementById("line-chart-l" + levelline).style.opacity == 0.7)
                                d3.select("#line-chart-l" + levelline)
                                    .style("opacity", 0);
                            else
                                d3.select("#line-chart-l" + levelline)
                                    .style("opacity", 0.7);

                        });


                    //levels.splice(4, 1);
                    mergedtree_svg
                        .append("g")
                        .attr("id", "levellines-grey")
                        .attr("transform",
                            "translate(" + (margin.left + 40) + "," + (margin.top + 800) + ")")
                        .selectAll("text")
                        .data(levels)
                        .enter()
                        .append("text")
                        .attr("class", function (d, i) {
                            return "text-level" + i;
                        })
                        .style("font-size", "40px")
                        .attr("dy", "2em")
                        .attr("x", function (d) {
                            return -150;
                        })
                        .attr("y", function (d) {
                            return d - 55;
                        })
                        .attr("text-anchor", function (d) {
                            return "start";
                        })
                        .attr("fill", "grey")
                        .text(function (d, i) {
                            //console.log(d + " " + i);
                            return "Level: " + i;
                        });

                }


                if (d3.select("#linkbutton").empty()) {
                    mergedtree_svg
                        .append("g")
                        .attr("id", "linkbutton")
                        .on("mouseover", function (d) {
                            d3.select(this).style("cursor", "pointer");
                        })
                        .on("click", function (d) {
                            if (d3.selectAll(".altlink")._groups[0].length == 0) {
                                console.log("show");
                                showlinks();
                            }

                            else {
                                console.log("hide");
                                hidelinks();
                            }
                        });
                    /*  .on("click", function (d) {
                         if (document.getElementsByClassName("link")[0].style.opacity == 0.5) {
                             d3.select("#mergedtree").selectAll(".link").style("opacity", 0);
                             d3.select("#mergedtree").selectAll(".altlink").style("opacity", 0.5);
                         }
                         else {
                             d3.select("#mergedtree").selectAll(".link").style("opacity", 0.5);
                             d3.select("#mergedtree").selectAll(".altlink").style("opacity", 0);
                         }
                     }); */


                    d3.select("#linkbutton")
                        .append("rect")
                        .attr('x', 3800)
                        .attr('y', 750)
                        .attr("class", "rounded")
                        .attr("height", 70)
                        .attr("width", 480)
                        .attr("fill", "#4CAF50")
                        //.style("stroke-width", "9px")
                        //.style("stroke", "red")
                        .style("opacity", 1)
                        .style("border-radius", "8px");



                    d3.select("#linkbutton")
                        .append("text")
                        .attr('x', 3810)
                        .attr('y', 780)
                        .attr("dy", ".40em")
                        .style("font-size", "45px")
                        .style("fill", "white")
                        .text("Show/hide links from TH");

                }


                if (d3.select("#levelbutton").empty()) {
                    mergedtree_svg
                        .append("g")
                        .attr("id", "levelbutton")
                        .on("mouseover", function (d) {
                            d3.select(this).style("cursor", "pointer");
                        })
                        .on("click", function (d) {
                            console.log("hi");
                            for (var l = 0; l < levels.length; l++) {
                                if (document.getElementById("line-chart-l" + l).style.opacity == 0.5)
                                    d3.select("#line-chart-l" + l)
                                        .style("opacity", 0);
                                else
                                    d3.select("#line-chart-l" + l)
                                        .style("opacity", 0.5);
                            }
                        });

                    d3.select("#levelbutton")
                        .append("rect")
                        .attr('x', 4300)
                        .attr('y', 750)
                        .attr("class", "rounded")
                        .attr("height", 70)
                        .attr("width", 425)
                        .attr("fill", "#008CBA")
                        //.style("stroke-width", "5px")
                        //.style("stroke", "red")
                        //.style("opacity", 0.3)
                        .style("border-radius", "5px");


                    d3.select("#levelbutton")
                        .append("text")
                        .attr('x', 4320)
                        .attr('y', 780)
                        .attr("dy", ".40em")
                        .style("font-size", "45px")
                        .style("fill", "white")
                        .text("Show/hide level lines");



                    var x = d3.scaleLinear()
                        .range([0, width])
                        .domain([0, width]);


                    var y = d3.scaleLinear()
                        .range([0, height - 300])
                        .range([0, height - 300]);

                    var xAxis = d3.axisBottom(x);

                    var yAxis = d3.axisLeft(y);

                    mergedtree_svg

                        .append("g")
                        .attr("id", "line-chart")
                        .attr("transform", "translate(160, 830)")

                    mergedtree_svg
                        .select("#line-chart")
                        .append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0,1200)")
                        .call(xAxis);

                    mergedtree_svg
                        .select("#line-chart")
                        .append("g")
                        .attr("class", "y axis")
                        .call(yAxis)

                }







                var datapoints = [];
                var lev = 3;
                //console.log(levels);
                //for (var l = lev - 1; l < lev; l++) {
                for (var l = 0; l < levels.length; l++) {


                    if (!d3.select("#line-chart-l" + l).empty())
                        d3.select("#line-chart-l" + l).remove();

                    //console.log(l + " " + levels[l]);

                    datapoints = [];
                    datapoints.push({ "x": 0, "y": l === 0 ? 50 : l * 300, "node": "dummy" });

                    var node_levels = nodes
                        .filter(function (d) {
                            //console.log(d);
                            //console.log(d.data.data.child + " level:" + l + " " + d.data.data.level + " " + d.data.data.alternatelevel);
                            if (d.data.data.level == l) {
                                //console.log("actual " + d.data.data.child + " " + d.data.data.level + " " + d.data.data.alternatelevel);
                                datapoints.push({ "x": d.x - 20, "y": d.data.data.level === 0 ? 50 : d.data.data.level * 300, "node": d.data.data.child });
                                datapoints.push({ "x": d.x + 20, "y": d.data.data.level === 0 ? 50 : d.data.data.level * 300, "node": d.data.data.child });
                                return d;
                            }

                            else if (d.data.data.alternatelevel == l && d.data.data.alternatelevel != "") {
                                //var offset = 100;
                                var offset = 0;
                                if (d.data.data.level < d.data.data.alternatelevel)
                                    offset *= -1;

                                //console.log("alt " + d.data.data.child + " " + d.data.data.level + " " + d.data.data.alternatelevel);
                                datapoints.push({ "x": d.x - 20, "y": d.data.data.level === 0 ? 50 : d.data.data.level * 300 + offset, "node": d.data.data.child });
                                datapoints.push({ "x": d.x + 20, "y": d.data.data.level === 0 ? 50 : d.data.data.level * 300 + offset, "node": d.data.data.child });
                                return d;
                            }
                        });


                    datapoints.push({ "x": width, "y": levels[l], "node": "dummy" });
                    //console.log(node_levels);




                    var line = d3.line()
                        .x(function (d, i) { return d.x; })
                        .y(function (d) {
                            return d.y;
                        })
                        .curve(d3.curveLinear);



                    datapoints.sort(function (x, y) {
                        return d3.ascending(x.x, y.x);
                    });


                    for (let d = datapoints.length - 1; d > 0; d--) {
                        //console.log("keeping " + datapoints[d].node);
                        //console.log("removing " + datapoints[d - 1].node);
                        if (datapoints[d - 1].x == datapoints[d].x) {
                            if (datapoints[d - 1].y == levels[l])
                                datapoints.splice(d - 1, 1);
                            else
                                datapoints.splice(d, 1);
                        }

                    }

                    //console.log(datapoints);

                    mergedtree_svg
                        .select("#line-chart")
                        .append("g")
                        .attr("id", "line-chart-l" + l)
                        .style("opacity", 0.5);

                    var fill = "none";
                    if (d3.select("#fillcolorradio")._groups[0][0].checked)
                        fill = accent(l);
                    else if (d3.select("#fillnoneradio")._groups[0][0].checked) {
                        fill = "none";
                    }

                    mergedtree_svg
                        .select("#line-chart-l" + l)
                        .append("path")
                        .datum(datapoints)
                        .attr("class", "line")
                        .attr("d", line)
                        .attr("stroke-width", 5)
                        .attr("fill", fill)
                        .attr("stroke", function (d) {
                            //console.log(d);
                            return accent(l);
                        });


                }


                //console.log(datapoints);




            }


            /* END OF MERGED TREE */


            /*   function drawh2links(links_data) {
                  console.log("draw h2 links");
     
                 
                 
     
     
     
     
              } */


            function recomputePositions_nodes(descendants) {
                console.log(descendants);

                if (!d.data.data.level % 2 == 0)


                    return descendants;
            }


            function createHierarchy(arrDims, h1, h2) {

                /*  console.log(arrDims);
                 console.log(h1);
                 console.log(h2); */

                var hier = [];
                hier.push({ "child": "root", "parent": "", "alternateparent": "", "color": mergedcolor, "shape": "merged" });
                var hier_str = "";
                for (let j = 1; j < arrDims.length; j++) {

                    for (let jj = 0; jj < arrDims[j].length; jj++) {
                        // console.log(arrDims[j][jj]);

                        if (arrDims[j][jj].color == mergedcolor) {
                            var h1_details = parent(arrDims[j][jj], h1);
                            var h2_details = parent(arrDims[j][jj], h2);

                            if (h1_details[1] < h2_details[1])
                                hier.push({ "child": arrDims[j][jj].name, "parent": h1_details[0], "alternateparent": h2_details[0], "color": mergedcolor, "shape": "merged" });

                            else
                                hier.push({ "child": arrDims[j][jj].name, "parent": h2_details[0], "alternateparent": h1_details[0], "color": mergedcolor, "shape": "merged" });

                        }

                        else if (arrDims[j][jj].color == h2color) {
                            hier.push({ "child": arrDims[j][jj].name, "parent": parent(arrDims[j][jj], h1)[0], "alternateparent": "", "color": h2color, "shape": "h2" });

                        }

                        else {
                            hier.push({ "child": arrDims[j][jj].name, "parent": parent(arrDims[j][jj], h2)[0], "alternateparent": "", "color": h1color, "shape": "h1" });
                        }


                    }
                }
                //  console.log(hier);
                return hier;

            }


            function parent(element, array) {
                // console.log(element);
                // console.log(array);
                for (var i = 0; i < array.length; i++) {

                    if (array[i].data.data.child == element.name) {
                        if (element.name == "root")
                            return ["", array[i].data.data.height];
                        else
                            return [array[i].data.data.parent, array[i].data.parent.height];
                    }
                }
            }


            function findDimensions(root) {
                const arrDims = [];

                //console.log(root);

                for (let i = 0; i <= root.height; i++) {
                    arrDims.push([]);
                }

                // console.log(arrDims);

                root.eachBefore(function (d) {
                    const str = d.depth;
                    //  arrDims[str].push({ "name": d.data.data.child, "depth": d.depth, "height": d.height });
                    arrDims[str].push(d.data.data.child);

                });

                return arrDims;
            }

            function parent_desc(element, array) {

                //console.log(element);
                //console.log(array);
                var child = array.filter(function (el) {
                    //console.log(el);

                    if (element == el.data.data.child) {
                        //  console.log(element);
                        // console.log(element + " " + el.parent.data.id);
                        return el.data.data.parent;
                    }

                });
                //console.log(child[0].parent.data.id);
                //console.log(child);
                if (child.length == 0)
                    return "";
                else
                    return child[0].parent.data.data.child;
            }



            function level_desc(element, array) {
                //console.log(element);
                //console.log(array);
                for (let i = 0; i < array.length; i++) {
                    for (let ii = 0; ii < array[i].length; ii++) {
                        if (array[i][ii].child == element || array[i][ii] == element) {
                            //console.log(i);
                            return i;
                        }
                    }
                }
            }

            function parent_hier(element, array) {

                //console.log(element);
                //console.log(array);

                for (i = 0; i < array.length; i++)
                    //console.log(i);
                    if (element == array[i].child) {
                        //console.log("MATCH");
                        //console.log(element + " " + array[i].child);
                        return array[i].parent;
                    }



                //console.log(child[0].parent.data.id);

            }


            function level_hier(element, array) {
                //console.log(array);
                //console.log(element);
                for (var i = 0; i < array.length; i++) {
                    if (array[i].child == element) {
                        //console.log(array[i].level);
                        return array[i].level;
                    }
                }
            }

            function flatten_array(array) {
                var hier = [];

                for (var h = 0; h < array.length; h++) {
                    for (var hh = 0; hh < array[h].length; hh++) {
                        hier.push(array[h][hh]);
                    }
                }

                // console.log(hier);


                return hier;
            }



            function bt_compareDimensions(h2, h1, h2_dims, h1_dims) {
                //console.log(h1);
                //console.log(h2);

                //console.log(h1_dims);
                //console.log(h2_dims);



                //var arrDims = [];


                var hier_flat = [];
                var index = 0;

                var h1_flat = flatten_array(h1);
                var h2_flat = flatten_array(h2);

                //console.log(h1_flat);
                //console.log(h2_flat);

                var maxLevels = Math.max(h1.length, h2.length);
                var hier = [];
                var hier_obj = [];
                var levelcolor = "";
                var bordertype = "";
                var linkcolor = "";
                var detailsh1 = "";
                var detailsh2 = "";
                var level = "";
                var altparent = "";

                for (let i = 0; i < maxLevels; i++) {
                    hier.push([]);
                    //arrDims_obj.push([]);
                }
                //console.log(hier);
                //console.log(hier.length);

                //var lev1 = level_desc(h1[i][ii], h1);
                //hier.push({ "child": h1[i][ii], "parent": parent_desc(h1[i][ii], h1_dims), "alternateparent": parent_desc(h1[i][ii], h2_dims), "color": mergedcolor, "shape": "merged", "level": avg_level });
                //hier_flat.push(h1[i][ii]);


                for (var i = 0; i < h1.length; i++) {
                    //console.log("h1 " + i);
                    for (var ii = 0; ii < h1[i].length; ii++) {

                        //console.log(h1[i][ii] + " " + i);
                        hier[i].push(h1[i][ii]);
                        hier_flat.push(h1[i][ii]);

                        detailsh1 = findDetails(h1_dims, h1[i][ii]);

                        //console.log(details);


                        //found only in h1
                        if (!h2_flat.includes(h1[i][ii])) {
                            //levelcolor = "blue";
                            hier_obj.push({
                                "child": h1[i][ii],
                                //"parent": parent_desc(h1[i][ii], h1_dims),
                                //"level": level_desc(h1[i][ii], h1),
                                //"bordertype": "solid",
                                //"description": findDescription(h1_dims, h1[i][ii]),

                                "parent": detailsh1[0],
                                "level": detailsh1[1],
                                "description": detailsh1[2],


                                "alternateparent": "",
                                "color": h1color,
                                "shape": "h1",

                                "alternatelevel": "",
                                "levelcolor": h1color,

                                "x": 0,
                                "y": 0,

                                "linkcolor": "red",

                                "h1parent": detailsh1[0],
                                "h2parent": ""
                            });
                            //break;

                            h1_flat.splice(h1_flat.indexOf(h1[i][ii]), 1);

                        }
                    }
                }



                for (var i = 0; i < h2.length; i++) {
                    //console.log("h2 " + i);
                    for (var ii = 0; ii < h2[i].length; ii++) {
                        //console.log(h2[i][ii]);
                        //console.log("h2 " + i + " " + ii);
                        levelcolor = h1color;
                        altparent = "";

                        detailsh1 = findDetails(h1_dims, h2[i][ii]);
                        detailsh2 = findDetails(h2_dims, h2[i][ii]);


                        //found in both
                        if (h1_flat.includes(h2[i][ii])) {
                            //console.log("both");

                            //var ancestor = findAncestor(h2[i][ii], h2_dims, h1, h1_dims);
                            //var ancestor_level = level_desc(ancestor, h1);
                            //console.log("element " + h2[i][ii] + " " + level_desc(h2[i][ii], h1));
                            //console.log(h2[i][ii] + " " + ancestor + " " + ancestor_level);
                            hier[i].push(h2[i][ii]);
                            hier_flat.push(h2[i][ii]);


                            if (detailsh2[1] == detailsh1[1])
                                levelcolor = h1color;
                            else if (detailsh2[1] < detailsh1[1])
                                levelcolor = "#4F7942";
                            else /*if((level_desc(h2[i][ii], h2) > level_desc(h2[i][ii], h1)))*/
                                levelcolor = "green";

                            //if (parent_desc(h2[i][ii], h1_dims) == parent_desc(h2[i][ii], h2_dims))
                            //  bordertype = "solid";


                            //else bordertype = "dashed";


                            //console.log(parent_desc(h2[i][ii], h2_dims));
                            if (detailsh1[0] == detailsh2[0])
                                linkcolor = "blue";
                            else
                                linkcolor = "red";


                            if (detailsh1[0] == detailsh2[0])
                                altparent == "";
                            else
                                altparent = detailsh2[0];


                            hier_obj.push({
                                "child": h2[i][ii],

                                //"parent": parent_desc(h2[i][ii], h1_dims),
                                //"level": level_desc(h2[i][ii], h1),
                                //"description": findDescription(h1_dims, h2[i][ii]),

                                "parent": detailsh1[0],
                                "level": detailsh1[1],
                                "description": detailsh1[2],


                                //"alternateparent": parent_desc(h2[i][ii], h2_dims),
                                //"alternatelevel": level_desc(h2[i][ii], h2),

                                "alternateparent": altparent,
                                "alternatelevel": detailsh2[1],


                                "color": mergedcolor,
                                "shape": "merged",


                                //"levelcolor": levelcolor,
                                "levelcolor": h1color,
                                //"bordertype": bordertype,
                                "x": 0,
                                "y": 0,

                                "linkcolor": linkcolor,

                                "h1parent": detailsh1[0],
                                "h2parent": detailsh2[0]
                            });

                            //hier[i].push(h2[i][ii]);
                            //hier_flat.push(h2[i][ii]);
                            // console.log(i + " " + ii + " " + h2[i][ii]);

                            // break;
                        }

                        else {
                            //console.log("element not included " + h2[i][ii]);
                            var ancestor = "";
                            var child = "";
                            var fa_result = findAncestor(h2[i][ii], h2_dims, h1, h1_dims);
                            //console.log(fa_result);
                            ancestor = fa_result[0];
                            if (fa_result[1] == 1) {

                                child = fa_result[2];
                                //console.log(child);

                                for (var h = 0; h < hier_obj.length; h++) {
                                    // console.log(h + " " + hier_obj[h].child);
                                    /* if (hier_obj[h].child == h2[i][ii]) {
                                        console.log("DO OBJECT UPDATED");
                                        hier_obj[h].level = (level_desc(fa_result[0]) + level_desc(fa_result[2])) / 2;
                                    } */
                                    if (hier_obj[h].child == child) {
                                        //console.log("OBJECT UPDATED");
                                        hier_obj[h].parent = h2[i][ii];
                                        hier_obj[h].alternateparent = parent_desc(child, h1_dims);

                                    }

                                }

                            }


                            var ancestor_level = level_desc(ancestor, h2);
                            //console.log(h2[i][ii] + " " + ancestor + " " + ancestor_level);
                            hier[ancestor_level + 1].push(h2[i][ii]);

                            if (ancestor == parent_desc(h2[i][ii], h2_dims))
                                bordertype = "solid";
                            //else bordertype = "dashed";

                            if (fa_result[1] == 1) {
                                //console.log("updt if");
                                //console.log(h2[i][ii] + ancestor);

                                if (ancestor == detailsh2[0])
                                    altparent == "";
                                else
                                    altparent = detailsh2[0];


                                hier_obj.push({
                                    "child": h2[i][ii],

                                    "parent": ancestor,
                                    "description": findDescription(h2_dims, h2[i][ii]),
                                    "level": (level_desc(fa_result[0], h1) + level_desc(fa_result[2], h1)) / 2,

                                    "alternateparent": altparent,
                                    "color": h2color,
                                    "shape": "h2",

                                    "alternatelevel": detailsh2[1],
                                    //"levelcolor": levelcolor,
                                    "levelcolor": h1color,
                                    //"bordertype": bordertype,
                                    "x": 0,
                                    "y": 0,

                                    "linkcolor": "green",

                                    "h1parent": "",
                                    "h2parent": ""

                                });
                                //break;
                            }
                            else {
                                //console.log("updt else");
                                //console.log(h2[i][ii] + " " + ancestor + " " + parent_desc(h2[i][ii], h2_dims));
                                //console.log(level_desc(ancestor, h2) + "" + level_desc(ancestor, h1) + "" + 1)
                                var anc_h1 = level_desc(ancestor, h1);
                                var anc_h2 = level_desc(ancestor, h2);

                                //detailsh2 = findDetails(h2_dims, h2[i][ii]);

                                if (anc_h1 == undefined)
                                    anc_h1 = 0;
                                if (anc_h2 == undefined)
                                    anc_h2 = 0;
                                //console.log(anc_h1 + " " + anc_h2 + (d3.max([anc_h1, anc_h2]) + 1));
                                hier_obj.push({
                                    "child": h2[i][ii],

                                    //"parent": parent_desc(h2[i][ii], h2_dims),
                                    //"description": findDescription(h2_dims, h2[i][ii]),
                                    //"alternatelevel": level_desc(h2[i][ii], h2),

                                    "parent": detailsh2[0],
                                    "description": detailsh2[2],
                                    "alternatelevel": detailsh2[1],


                                    "level": d3.max([anc_h1, anc_h2]) + 1,
                                    "alternateparent": "",
                                    "color": h2color,
                                    "shape": "h2",
                                    //"level": level_desc(parent_desc(h2[i][ii], h2_dims), h2) + 1,
                                    //"level": ancestor_level + 1,


                                    //"levelcolor": levelcolor,
                                    "levelcolor": h1color,
                                    //"bordertype": bordertype,
                                    "x": 0,
                                    "y": 0,

                                    "linkcolor": "green",

                                    "h1parent": "",
                                    "h2parent": detailsh2[0]
                                });
                                //break;
                            }

                        }
                    }
                }


                //console.log(hier);
                //console.log(hier_flat);
                //console.log(hier_obj);
                return hier_obj;

            }


            function findDetails(array, element) {
                var parent = "";
                for (var i = 0; i < array.length; i++) {
                    if (array[i].data.data.child == element) {
                        //console.log(array[i]);
                        if (array[i].data.data.child != "root")
                            parent = array[i].parent.data.data.child;
                        else
                            parent = "";
                        return [parent, array[i].depth, array[i].data.data.description];
                    }
                }
            }


            function findDescription(array, element) {
                for (var i = 0; i < array.length; i++) {
                    if (array[i].data.data.child == element)
                        return array[i].data.data.description;
                }
            }

            function findAncestor(element, h2_array, h1_array, h1_dims) {

                //console.log(flatten_array(h1_array))
                var flat_h1_array = flatten_array(h1_array);
                var flag_parent = 0;
                var flag_child = 0;
                var child = "";

                var parent = parent_desc(element, h2_array);

                //console.log(element + " " + parent);
                //console.log(h2_array);
                //console.log(flat_h1_array);
                //console.log(h1_dims);


                if (flat_h1_array.includes(parent)) {
                    flag_parent = 1;

                    for (var i = 0; i < h2_array.length; i++) {
                        if (element == h2_array[i].data.data.child) {
                            //console.log(h2_array[i].children);
                            if (typeof h2_array[i].children != "undefined") {
                                //console.log()
                                for (var c = 0; c < h2_array[i].children.length; c++) {
                                    // console.log(h2_array[i].children[c].data.data.child);
                                    if (flat_h1_array.includes(h2_array[i].children[c].data.data.child)) {
                                        flag_child = 1;
                                        child = h2_array[i].children[c].data.data.child;
                                    }
                                }
                            }
                            else flag_child == 0;
                        }
                    }
                    //console.log("child and parent", child + " ** " + parent);
                    if (flag_parent == 1 && flag_child == 1) {
                        //console.log("return");
                        return [parent, 1, child];
                    }
                    else
                        return [parent, 0, ""];
                }

                else {
                    //console.log("entered else");
                    for (var i = 0; i < h2_array.length; i++) {
                        //console.log(h2_array[i]);
                        if (element == h2_array[i].data.data.child) {
                            //console.log(h2_array[i].data.data.parent);
                            //return [parent, 0, ""];
                            return [h2_array[i].data.data.parent, 0, ""];
                            /* for (var anc = 0; anc < h2_array[i].ancestors().length; anc++) {
                                console.log(h2_array[i].ancestors()[anc].data.data.child);
                                if (flat_h1_array.includes(h2_array[i].ancestors()[anc].data.data.child)) {
                                    console.log("match found " + h2_array[i].ancestors()[anc].data.data.child);
                                    return [h2_array[i].ancestors()[anc].data.data.child, 0, ""];
                                }
                            } */


                        }
                    }
                }
            }


        }

    </script>
</body>

</html>